---
timezone: UTC+8
---

# Quinn

**GitHub ID:** baikingrio

**Telegram:** 

## Self-introduction

巩固加强Web3技术开发能力和拓展知识面。

## Notes

<!-- Content_START -->
# 2026-01-17
<!-- DAILY_CHECKIN_2026-01-17_START -->
## 了解UniswapV2合约的代币交换机制

在 Uniswap V2 中，交换是通过Pair合约执行的。每次交换都会改变Pair中两个代币的储备余额，同时保持恒定乘积公式x\*y=k。

当用户想要用代币 A 交换代币 B 时：

1.  用户将代币 A 发送到Pair合约
    
2.  Pair合约计算可以接收的代币 B 的数量（基于当前的储备比率和 0.30% 的费用）
    
3.  Pair合约将代币 B 发送给用户
    
4.  储备余额更新，但 `k` 值增加（由于费用）
    

交换价格由以下因素决定：

1.  当前储备比率 - 配对中两种代币的当前余额
    
2.  交换规模 - 相对于储备量的交换大小
    
3.  费用 - 每笔交易收取 0.30% 的费用
    

较大的交换相对于储备量会产生更多的滑点，因为价格沿着恒定乘积曲线移动。

如果两个代币之间没有直接配对，可以通过中间代币进行多路径交换。Router 合约自动处理这些路径，找到最佳路由。
<!-- DAILY_CHECKIN_2026-01-17_END -->

# 2026-01-15
<!-- DAILY_CHECKIN_2026-01-15_START -->

## 阅读Uniswap V2工厂合约代码

Uniswap V2 的工厂合约（UniswapV2Factory.sol）是 Uniswap 协议的核心组件之一，用于创建和管理流动性池对（Pair）。它本质上是一个“工厂”，负责标准化地部署交易对合约，确保每个 token 对只有一个唯一的流动性池，从而避免流动性碎片化。代码很简洁高效，只有不到 50 行，但缺体现了 Uniswap 的创新设计。

首先，合约实现了 IUniswapV2Factory 接口，定义了几个关键状态变量：feeTo（手续费接收地址，默认没有设置）和 feeToSetter（设置 feeTo 的权限持有者，由构造函数初始化）。有一个 mapping getPair，用于存储 token0 和 token1 之间的 pair 地址，支持双向查询；还有 allPairs 数组，记录所有创建的 pair，便于外部查询总数（通过 allPairsLength 函数）。

核心函数是 createPair，它允许任何人创建新的 token 对。函数先检查输入：tokenA 和 tokenB 不能相同，不能为零地址，且 pair 不存在。然后，通过比较地址大小排序 token0 和 token1，确保唯一性。部署使用 create2 操作码，这是一个关键创新点：利用 bytecode（UniswapV2Pair 的创建代码）和 salt（keccak256 编码的 token0+token1）来确定性地生成 pair 地址。这种方式让 pair 地址可预测，避免了传统 create 的随机性，有助于链上交互和安全性。部署后，调用 pair 的 initialize 初始化 token0 和 token1，更新 mapping 和 allPairs，并发出 PairCreated 事件，记录 pair 的创建顺序。

权限控制方面，setFeeTo 和 setFeeToSetter 函数确保只有 feeToSetter 能修改 feeTo（用于协议手续费）和转移 setter 权限。这体现了去中心化治理的初步形式：初始 setter 可以是部署者，后来可转移给 DAO 等。feeTo 如果设置，手续费的 1/6 会流向它，否则默认关闭协议费。

总结一下，这个合约做到了最小化信任假设，任何人可创建 pair，无需许可，促进开放 DeFi 生态。create2 的使用提升了效率和可组合性，例如允许 flash loan 等高级应用。相比 V1，V2 Factory 更灵活，支持任意 ERC20 对，而非只 ETH。整体上，它是 AMM 模型的基石，推动了流动性提供和价格发现的自动化。
<!-- DAILY_CHECKIN_2026-01-15_END -->

# 2026-01-14
<!-- DAILY_CHECKIN_2026-01-14_START -->


Uniswap V2 的核心由两个存储库组成：core 和 periphery。核心合约为所有与 Uniswap 交互的参与方提供基本的安全保障。外围合约与一个或多个核心合约交互，但其本身并非核心合约的一部分。

## 核心合约

核心合约由一个单例工厂和许多交易对组成，工厂负责创建和索引这些交易对。这些交易对非常简洁，这样做的理由很简单：一是更容易理解，二是不容易出错，功能也更优雅。这种设计最大的优点或许在于，系统的许多所需属性可以直接在代码中声明，从而最大限度地减少了出错的可能性。然而，缺点在于核心合约和交易对合约对用户不太友好。事实上，在大多数情况下，不建议直接与这些交易对进行交互。相反，更推荐使用外围合约调用交易对。

## 工厂合约

工厂合约负责创建交易对合约。它的主要任务是为每个唯一的代币对创建一个唯一交易对合约。它还包含启用协议收费的逻辑。

## 交易对合约

交易对有两个主要用途：一是作为自动做市商，二是跟踪资金池代币余额。它们还会公开可用于构建去中心化价格预言机的报价数据。

## 外围合约

外围系统是由一系列智能合约组成的集合，它负责安全高效地与 Uniswap V2 核心、工厂合约交互。

## 库合约

库合约提供了各种便捷的函数，用于获取数据和定价。

## 路由合约

路由合约充分使用库合约，支持前端调用进行交易、流动性管理等功能。它支持多交易对交易，比如从x代币到y代币再到z代币，还提供一处流动性的功能。通常Dapp前端中会经常调用路由合约的功能。
<!-- DAILY_CHECKIN_2026-01-14_END -->

# 2026-01-13
<!-- DAILY_CHECKIN_2026-01-13_START -->



Uniswap 是一个基于恒定乘积公式的自动化流动性协议，它通过以太坊区块链上不可升级的智能合约系统实现。Uniswap 无需可信中介机构，优先考虑去中心化、抗审查性和安全性。Uniswap 是开源软件，采用 GPL 许可协议。  
每个 Uniswap 智能合约（称为 pair 交易对）管理一个流动性池，它包含两种 ERC-20 代币的储备。  
  
任何人都可以通过向池中存入等值的底层代币成为资金池的流动性提供者（LP），并收到资金池代币作为回报。这些池代币代表 LP 在总储备中的份额，并且可以随时赎回相应比例的底层资产。

配对作为自动化做市商（AMM）运行，只要维持"恒定乘积"公式，就可以随时用一种代币交换另一种代币。该公式表示为 \`x \* y = k\`，确保配对储备余额（\`x\` 和 \`y\`）的乘积（\`k\`）在交易期间保持不变。因此，相对于储备量较大的交易，其执行价格会按指数级恶化。  
Uniswap 对每笔交易收取 0.30% 的手续费，该费用会添加到储备中。这意味着每次交易都会使\`k\`值增大，这相当于给流动性提供者（LP）带来收益。LP 在销毁自己的池代币以提取其应得的储备金份额时，即可实现收益。未来，该费用可能会降至 0.25%，剩余的 0.05% 作为协议的固定费用。
<!-- DAILY_CHECKIN_2026-01-13_END -->

# 2026-01-12
<!-- DAILY_CHECKIN_2026-01-12_START -->




![WeChat509bc988ca05c9df2227c761fde707a1.jpg](https://raw.githubusercontent.com/IntensiveCoLearning/Web3_Internship_Bootcamp_2026_Winter/main/assets/baikingrio/images/2026-01-12-1768183404462-WeChat509bc988ca05c9df2227c761fde707a1.jpg)

今天的计划是详细阅读UniswapV2文档，在V1版本上进行了很大的变化。

| 核心特性 | 技术要点说明 | 主要意义/改进 |
| --- | --- | --- |
| 任意 ERC-20 ↔ ERC-20 | 不再强制通过 ETH 中转，可直接创建任意两种 ERC-20 的交易对 | 极大提升灵活性，减少滑点和 gas 消耗 |
| 定价公式 | x × y = k（恒定乘积做市商） | 简单、数学上永不破产（但存在无常损失） |
| 交易手续费 | 0.3%（全部给 LP），可选开启 0.05% 协议费（LP 得 0.25%） | 协议费开关写死在合约里，基本不可改 |
| 闪电兑换（Flash Swap） | 先拿走想要的 token，同一交易内必须归还（可还另一种 token 等值） | 开启套利、清算、抵押品拍卖等高级用法 |
| TWAP 价格预言机 | 每个区块开始时记录当时池子价格，累加成 cumulative price（uint112） | 抗短期操纵，为链上其他协议提供相对安全价格 |
| 合约结构 | Factory + Pair 双层结构，核心合约不可升级，极简设计 | 经典且安全，被最多项目直接复制 |
| 重要安全设计 | - 强制检查 balance 防 donation attack - 烧毁 1000 份最小流动性 - sync()/skim() 逃生通道 | 修复了 V1 很多工程上的危险边界情况 |
<!-- DAILY_CHECKIN_2026-01-12_END -->
<!-- Content_END -->
