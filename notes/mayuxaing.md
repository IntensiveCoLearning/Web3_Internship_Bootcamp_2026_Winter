---
timezone: UTC+8
---

# mayuxiang

**GitHub ID:** mayuxaing

**Telegram:** @Ma_0xFly

## Self-introduction

Web3 实习计划 2025 冬季实习生

## Notes

<!-- Content_START -->
# 2026-01-12
<!-- DAILY_CHECKIN_2026-01-12_START -->
\# 以太坊（世界计算机）

以太坊被称为 “世界计算机”，核心是它突破了比特币仅能处理简单价值转移的局限，靠去中心化架构、图灵完备的智能合约等技术，构建了一个全球可访问、能承载复杂计算与多样化应用的分布式计算平台。下面以计算机五层结构拆解分析

\## 五层结构

\### 硬件层

核心作用：为整个以太坊网络提供物理硬件支持，是 “世界计算机” 的 “硬件主机”

组成部分：全球范围内参与以太坊网络的节点设备，包括个人电脑、服务器、专业矿机（合并后以验证节点设备为主）等

关键特点：去中心化分布，无单一控制中心，节点越多，网络安全性、稳定性越强，确保 “世界计算机” 持续运行不宕机

\### 内核层（操作系统层）

核心作用： 在这些不可信硬件上，实现“一个统一的状态机 + 资源调度”

核心功能：pos权益证明机制，gas机制

1\. 把所有节点连成一个 P2P 网络（网络子系统）

2\. 在节点之间达成“\*\*谁的区块算数\*\*”的共识（共识子系统）

3\. 控制“\*\*谁先来打包交易谁来验证交易、每个区块能装多少东西\*\*”（调度/调度器）

4\. 控制“\*\*每个操作要花多少资源 / 钱\*\*”（资源管理：Gas & Fee Market）

5\. 把“执行层（EVM）”的状态转移结果纳入全局（状态机转移接口）

\#### pos权益证明机制

当前共识机制：权益证明（PoS），取代原有的工作量证明（PoW）

原理：节点通过质押一定数量的 ETH 成为验证者，按规则打包交易、生成区块，合规则验证者获得奖励，违规者将被惩罚（扣除质押的 ETH）

优势：降低能源消耗，提升网络效率，同时通过 “质押成本” 保障节点诚实性

\#### gas

1\. **资源计量与成本化**

所有 EVM 操作（opcode）都有固定 gas 消耗，gas 用于精确计量“计算量 + 存储 + 带宽”。

通过让执行成本显式化，确保链上资源稀缺可定价。

2\. **防止 DoS 与无限计算**

交易必须预付 gas，执行过程中 gas 用尽会被中止。

这使得任何无限循环、恶意大计算、垃圾交易都无法无成本消耗网络资源。

3\. **交易排序与拥堵调节（Fee Market）**

Gas price/priority fee 作为经济信号，在拥堵情况下让用户竞争区块空间。

节点根据费用从高到低选择交易，实现市场化调度。

总结：

**Gas = 区块链的资源管理系统，负责计量成本、防 DoS、调节交易优先级，是以太坊作为“世界计算机”能稳定运行的关键内核机制。**

\### 处理层（以太坊虚拟机EVM，全球同步的软件CPU）

EVM 是以太坊上的 **虚拟 CPU + 沙箱执行环境**，专门用来运行智能合约。它执行 bytecode，确保所有节点执行结果一致（确定性）。

\#### EVM 的执行模型（Execution Model）

EVM 执行一笔交易主要包含以下步骤：

1\. 加载交易

交易包含 to、value、data，用作智能合约调用的入口。

2\. 初始化执行上下文

包含：

\+ 程序计数器 PC

\+ 栈（stack）

\+ 内存（memory）

\+ 存储（storage）

\+ gas（燃料配额）

3\. 逐条执行 opcode

EVM 执行汇编级操作，包括算术、控制流、调用、存储、日志等。

4\. gas 用尽则 revert

执行中 gas 不够，会回滚所有状态修改，但已消耗的 gas 不退还。

\---

\#### EVM 的内存结构（Stack/Memory/Storage）

栈（Stack）

\+ LIFO 栈

\+ 最大深度 1024

\+ 所有 opcode 参数都来自栈顶

内存（Memory）

\+ 执行期间的临时数据区

\+ 线性扩展，执行结束即清空

存储（Storage）

\+ 合约的持久化状态

\+ 写入非常贵（类似写磁盘）

\---

\#### 合约间调用（CALL / DELEGATECALL）

CALL

\+ 新建一个独立的执行上下文

\+ 自己用自己的 storage

\+ 能转 ETH

DELEGATECALL

\+ 使用 **被调用合约的代码**

\+ 使用 **调用者的 storage（非常危险）**

\+ 是代理合约与许多漏洞的源头

（类比：把别人的函数在你的进程里执行，并用你的全局变量）

\---

\#### Solidity → EVM 的编译流程

1\. Solidity 源码

2\. 编译为 Yul（中间 IR）

3\. 编译为 EVM bytecode

4\. 部署到链上

5\. 由 EVM 逐条执行指令

（类比：C → LLVM IR → 汇编 → 机器码 → CPU）

\---

\#### EVM 的局限性

\+ 是纯栈机（无寄存器）

\+ 无浮点数

\+ 内存只增大不缩小

\+ CALL 返回值要手动检查

\+ DELEGATECALL 容易被利用

\+ 无线程和并发
<!-- DAILY_CHECKIN_2026-01-12_END -->
<!-- Content_END -->
