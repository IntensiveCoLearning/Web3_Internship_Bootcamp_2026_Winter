---
timezone: UTC+8
---

# Lemonadeccc

**GitHub ID:** Lemonadeccc

**Telegram:** 

## Self-introduction

Web3 实习计划 2025 冬季实习生

## Notes

<!-- Content_START -->
# 2026-01-19
<!-- DAILY_CHECKIN_2026-01-19_START -->
### **智能合约开发核心总结**

**一、核心理念：Dapp 架构与开发**

智能合约开发不仅仅是编写合约代码，而是构建一个完整的**去中心化应用**。

1.  **核心架构**：
    
    -   **前端 (UI)**：用户界面，使用 React/Vue 等框架构建。通过 **钱包**（如 MetaMask）或 **RPC 节点** 与区块链交互，**不直接连接链**。
        
    -   **智能合约**：应用逻辑的核心，部署在区块链上，使用 Solidity 等语言编写。
        
    -   **数据检索器**：**关键组件**。监听并索引链上合约事件（如 `Transfer`），将数据存储到传统数据库（如 PostgreSQL），供前端高效查询复杂数据（如“某地址拥有的所有NFT”）。
        
    -   **去中心化存储**：用于存储图片、文件等大容量数据（如 IPFS, Arweave），保证数据的持久性和抗审查性。
        
2.  **标准开发流程**：
    
    1.  **需求分析与规划**：明确功能、选择区块链平台、设计UX。
        
    2.  **智能合约开发**：编写、测试（单元测试）、审计（安全至关重要）、优化（Gas）。
        
    3.  **检索器开发**：确定所需数据模型，使用框架（如 Ponder, Subgraph）编写索引逻辑，并部署运维。
        
    4.  **前端开发**：构建UI，集成钱包，使用库（**推荐 Viem/Wagmi**）与合约交互。
        
    5.  **部署与上线**：将合约部署到测试网（如 Sepolia）进行最终验证，然后部署到主网。
        

**二、开发环境与基础设施**

1.  **本地开发链**：
    
    -   **Foundry**：Rust实现，速度极快。包含 `forge`（构建测试）、`anvil`（本地节点）、`cast`（链交互工具）。适合追求性能和现代工具链的开发者。
        
    -   **Hardhat**：基于 JavaScript/TypeScript，插件生态丰富。**对于新手和大多数项目推荐使用 Hardhat**。
        
2.  **RPC 节点服务**：
    
    -   **作用**：前端与区块链网络交互的桥梁，用于查询数据、发送交易。
        
    -   **服务商选择**：
        
        -   **开发/测试**：Public Node、Infura免费额度。
            
        -   **生产环境**：**Alchemy**（稳定、文档好）、**QuickNode**（高性能、低延迟）。
            
    -   **最佳实践**：
        
        -   **保护API Key**：使用环境变量，切勿提交至代码仓库。
            
        -   **多节点备份**：配置多个RPC提供商，实现故障转移。
            
        -   **错误处理与重试**：网络请求需有重试机制。
            
        -   **开发时优先使用本地节点**（如 `anvil` 或 `npx hardhat node`），速度快且无限制。
            

**三、Solidity 智能合约编程精要**

1.  **基础结构**：
    
    -   `pragma solidity ^0.8.0;` 声明编译器版本。
        
    -   **状态变量**：永久存储在链上的数据。
        
    -   **函数**：包含可见性（`public`, `private`, `internal`, `external`）、状态可变性（`view`, `pure`, `payable`）。
        
    -   **修饰符 (Modifier)**：用于函数执行前的检查（如权限控制 `onlyOwner`）。
        
    -   **事件 (Event)**：使用 `emit` 触发，用于记录链上日志，是检索器的主要数据源。
        
    -   **继承与接口**：支持代码复用和多态。
        
2.  **安全实践（重中之重）**：
    
    -   **重入攻击**：
        
        -   **漏洞**：恶意合约在收到 ETH 后，在回调函数中再次调用提款函数。
            
        -   **防护**：遵循 **检查-生效-交互 (Checks-Effects-Interactions)** 模式，或使用 OpenZeppelin 的 `ReentrancyGuard` 修饰符。
            
    -   **访问控制**：
        
        -   **漏洞**：管理函数未设限，任何人可调用。
            
        -   **防护**：使用 `Ownable` 合约的 `onlyOwner` 修饰符，或更细粒度的 `AccessControl`。
            
    -   **整数溢出**：
        
        -   **防护**：Solidity 0.8.0 及以上版本默认进行溢出检查。对于老版本或特殊场景，使用 `unchecked` 块需极度谨慎。
            

**四、实战全流程：从编码到用户交互**

1.  **编写合约**：在 Remix IDE 或本地用 Hardhat/Foundry 编写 Solidity 代码。
    
2.  **编译与本地测试**：在 Remix 或通过 `forge test` / `npx hardhat test` 进行测试。
    
3.  **部署到测试网**：
    
    -   配置 Hardhat/Foundry 连接 Sepolia RPC。
        
    -   运行部署脚本，将合约上链。
        
    -   在 **Etherscan (Sepolia)** 上验证合约并查看交易详情。
        
4.  **前端集成**：
    
    -   创建网页
        
    -   **连接钱包**：调用 `window.ethereum.request({ method: ‘eth_requestAccounts’ })`。
        
    -   **实例化合约**：使用 **Viem** ，结合合约 ABI 和地址。
        
    -   **调用合约**：
        
        -   **读取 (**`call`**)**：免费，如查询留言。
            
        -   **写入 (**`send`**)**：需支付 Gas，弹出钱包确认，如发布新留言。
            

**五、成为高阶开发者**

1.  **Gas 优化**：直接关系到用户体验和成本。核心是减少昂贵的存储操作 (`SSTORE`)，善用内存和 `calldata`，优化循环和数据结构。
    
2.  **全面的安全审计**：
    
    -   **工具扫描**：使用 **Slither**（静态分析）、**MythX** 进行自动化检查。
        
    -   **人工审计**：对于持有大量资金的项目，必须聘请专业审计机构（如 OpenZeppelin, ConsenSys Diligence）进行人工代码审查。
        
3.  **专业的开发协作**：
    
    -   使用 **Git** 进行版本控制，采用功能分支工作流。
        
    -   规范 **Commit Message** 和 **Pull Request** 流程。
        
    -   建立 **Code Review** 制度，重点关注逻辑正确性、安全性和 Gas 效率。
        
4.  **探索 Layer 2 扩容**：
    
    -   **Optimistic Rollups**（如 **Arbitrum, Base**）：兼容 EVM，开发体验平滑，但提款有挑战期。
        
    -   **ZK Rollups**（如 **zkSync, Starknet**）：安全性更高，提款快，但生态和工具链略有不同。
        
    -   未来开发需根据项目需求选择合适的主网或 L2。
<!-- DAILY_CHECKIN_2026-01-19_END -->

# 2026-01-18
<!-- DAILY_CHECKIN_2026-01-18_START -->

021第三章账户类型

## **1.账户基础：两种类型**

以太坊只有两种账户，其根本区别在于 **控制权归属**：

-   **EOA**：由**私钥**直接控制。像“人+银行卡”，能主动发起交易。
    
-   **合约账户**：由**部署的代码**控制。像“写死规则的自动售货机”，只能被调用后按逻辑执行。
    

| 属性 | EOA | 合约账户 |
| --- | --- | --- |
| 控制主体 | 私钥持有者 | 智能合约代码 |
| 私钥 | 有 | 无 |
| 代码(Code) | 空 | 有EVM字节码 |
| 存储(Storage) | 无 | 有状态存储 |
| 发起交易 | 能主动发起 | 不能，只能响应调用 |

## **2.账户创建与地址计算**

### **1\. 创建方式**

-   **EOA**：本地生成密钥对，**无需上链、不花Gas**。
    
-   **合约账户**：通过一笔**创建合约的交易**部署，需支付Gas将代码永久写入链上。
    

### **2\. 地址计算规则**

-   **CREATE**：`地址 = keccak256(RLP([创建者地址, 创建者nonce]))` 的后20字节。
    
    -   地址**不可提前精确预测**（除非知道nonce）。
        
-   **CREATE2**：`地址 = keccak256(0xff + 创建者地址 + salt + keccak256(init_code))` 的后20字节。
    
    -   地址**可提前精确计算**。
        
    -   核心价值：**可预测地址**、跨链部署一致性，用于工厂合约、代理模式等。
        

## **三、 账户状态（世界状态中的四元组）**

无论EOA或合约账户，在状态树中均由四个字段表示：

1.  **nonce**:
    
    -   EOA：已发送的交易数量。
        
    -   合约账户：已创建的子合约数量。
        
2.  **balance**: 账户持有的ETH余额（单位：wei）。
    
3.  **storageRoot**: 存储树的根哈希。
    
    -   EOA：固定空值。
        
    -   合约账户：存储所有状态变量。
        
4.  **codeHash**: 账户代码的哈希值。
    
    -   EOA：空代码的哈希。
        
    -   合约账户：运行时字节码的哈希。
        

**关键理解**：合约账户既能持有ETH，又能通过存储树维护复杂状态（如代币余额）。

## **四、 调用机制：谁可以发起交易？**

-   **唯一主动发起者**：**EOA**。
    
    -   合约账户**不能**主动发起顶层交易。
        
    -   所有链上交易的起点，必须是一个由私钥签名的EOA。
        
-   **调用链条**:
    
    1.  **EOA → 合约账户**：通过**外部交易**触发。
        
    2.  **合约账户 → 合约账户**：通过`call`/`delegatecall`/`staticcall`等**内部消息调用**，消耗原交易的Gas。
        
    3.  **合约账户 → EOA**：可在执行中转账，但仍是内部调用的一部分。
        

## **五、 账户抽象与未来演进**

-   **ERC-4337 (账户抽象)**：
    
    -   让**智能合约钱包**具备类似EOA的用户体验（批量操作、代付Gas等）。
        
    -   底层逻辑：用户提交`UserOperation` → Bundler用其EOA打包成交易 → 调用`EntryPoint`合约执行。
        
    -   **本质未变**：最终上链的交易仍由EOA（Bundler）签名发起。
        
-   **EIP-7702 (Pectra升级)**：
    
    -   允许EOA在单笔交易期间**临时授权**一段合约代码来控制自己。
        
    -   旨在协议层为智能账户提供更优支持，**不改变**“合约不能凭空发起交易”的根基。
        

## **六、 钱包实践：MetaMask如何管理EOA**

1.  **核心秘密**：**助记词**，遵循BIP-39/BIP-44标准。
    
    -   本地加密存储，**绝不**上传服务器。
        
    -   泄露助记词 = 失去所有资产控制权。
        
2.  **交易流程**：dApp请求 → 钱包弹窗展示详情 → 用户确认 → **本地私钥签名** → 通过RPC广播交易。
    
3.  **支持智能账户**：MetaMask已集成ERC-4337，用户可在“普通EOA”和“智能账户”间切换。
    

## **七、 代币的本质**

ERC-20/ERC-721等代币**并非独立资产**，而是**智能合约账户内的记账系统**。

-   “拥有代币” = 在代币合约的`storage`映射中，有对应你地址的一条记录。
    
-   “转账代币” = **调用代币合约**的`transfer`函数，**更新合约内部的存储映射**。
    

## **八、 合约的不可变性与“销毁”**

1.  **代码不可更改**：合约一旦部署，其字节码默认**不可修改**。
    
2.  **SELFDESTRUCT的现状**（EIP-6780后）：
    
    -   **已弱化**：在非创建交易中调用，**仅转走余额，不再删除代码和存储**。
        
    -   依赖`SELFDESTRUCT`的“变形合约”模式已基本失效。
        
3.  **主流升级方案**：**代理合约模式**。
    
    -   保持代理合约地址不变，通过更换逻辑合约地址来实现升级。
        

## **九、 关键零散知识点**

-   **地址以**`0x`**开头**：仅是十六进制表示的编程惯例，便于识别，非协议强制。
    
-   **多签钱包**：本质是一个需要多个签名才能执行的**智能合约**，如Gnosis Safe。
    
-   **时间锁**：将敏感操作延迟执行的智能合约，为社区提供反应时间，广泛用于治理升级。
<!-- DAILY_CHECKIN_2026-01-18_END -->

# 2026-01-17
<!-- DAILY_CHECKIN_2026-01-17_START -->


### **021第二章**

**一、节点与客户端**

-   **节点（Node）**：任何一台运行以太坊客户端软件并连接到网络的计算机。
    
-   **客户端（Client）**：对以太坊协议的具体软件实现（如Geth, Lighthouse）。
    
-   **关系**：客户端是软件，节点是运行该软件的机器实例。
    

**二、The Merge后的新架构：三大件**

一个完整的以太坊节点由两个必备客户端组成，如需出块则增加第三个：

1.  **执行客户端（EL）**
    
    -   **职责**：处理交易、执行智能合约（EVM）、维护当前状态数据库、提供 `eth_*` JSON-RPC接口。
        
    -   **常见实现**：Geth, Nethermind, Besu, Erigon, Reth。
        
2.  **共识客户端（CL）**
    
    -   **职责**：运行权益证明（PoS）共识，维护信标链，选择区块提议者，处理验证者投票，决定最终链头。
        
    -   **常见实现**：Lighthouse, Prysm, Teku, Nimbus, Lodestar。
        
3.  **验证者客户端（Validator）**
    
    -   **职责**：管理验证者密钥，在轮到时提议区块，并对看到的区块进行投票（attestation）。
        

**三、协同核心：Engine API**

-   执行客户端（EL）和共识客户端（CL）之间的专用JSON-RPC通信接口。
    
-   共识客户端通过它让执行客户端“执行交易并生成结果”（`engine_getPayload`），或“验证他人区块的执行结果”（`engine_newPayload`）。这是两者协作的“内线电话”。
    

**四、节点间的连接与通信**

1.  **发现**：基于UDP和Kademlia算法，通过引导节点找到并建立邻居列表。
    
2.  **连接**：建立加密的TCP连接（RLPx/devp2p协议），并在其上复用多种子协议。
    
3.  **传播**：
    
    -   **Gossip协议**随机将新交易/区块转发给部分邻居，实现快速、去中心化的全网扩散。
        
    -   **请求-响应**：用于按需拉取缺失的历史数据。
        

**五、节点类型对比**

| 类型 | 存储内容 | 资源消耗 | 主要用途 | 信任模型 |
| --- | --- | --- | --- | --- |
| 全节点 | 所有区块 + 最近~128个区块的完整状态（旧状态被修剪） | 中等（~500GB-1TB SSD） | 自托管RPC、验证交易、作为验证者基础 | 完全自我验证，最去中心化 |
| 归档节点 | 全节点数据 + 从创世至今所有历史状态快照 | 极高（2TB-12TB+ SSD） | 区块浏览器、链上深度分析、历史审计 | 同全节点，且能即时查询任意历史状态 |
| 轻节点 | 只存区块头，不存完整区块和状态 | 极低（MB级） | 手机钱包、浏览器插件、资源受限设备 | 依赖全节点提供数据，但可通过Merkle证明验证 |

**图书馆类比**：

-   **全节点**：大型图书馆，有所有书目（区块），但只将最新版本的书（状态）放在阅览室。
    
-   **归档节点**：国家档案馆，保存每一本书的每一个历史版本。
    
-   **轻节点**：移动电子目录机，只存索引（区块头），借书时向图书馆索取并核对。
    

**六、运行自有全节点必要性**

1.  **隐私**：避免将你的交易查询、钱包地址和IP暴露给公共RPC提供商。
    
2.  **安全与主权**：遵循“Don‘t trust, verify”原则，独立验证所有交易和状态，不依赖第三方。
    
3.  **抗审查与可用性**：避免因公共RPC服务限流、宕机或政策影响你的dApp。
    
4.  **支持去中心化**：增加网络韧性，并通过选择非主导客户端（客户端多样性）降低单点故障风险。
    

**七、归档节点优势**

-   **即时历史查询**：无需重放交易，即可瞬间回答“在区块 #X 时，某地址/合约的状态是什么？”这类问题。
    
-   **数据查询的“时间机器”**：是区块链浏览器、深度数据分析、审计和策略回测的基础设施。
    
-   **代价**：存储成本巨大（TB级别），同步时间漫长。
    

**八、节点同步模式**

-   **快照同步（Snap Sync）**：推荐模式。先下载区块链，再获取一个近期的状态快照，最后进行状态愈合。速度最快（数小时至数天）。
    
-   **全同步（Full Sync）**：从创世块开始重放所有交易，严格验证。速度慢，但验证最完整。
    
-   **归档同步（Archive Sync）**：在全同步基础上不修剪任何历史状态，用于搭建归档节点。\`
<!-- DAILY_CHECKIN_2026-01-17_END -->

# 2026-01-14
<!-- DAILY_CHECKIN_2026-01-14_START -->



安全合规相关

只装官方软件、面试不轻信他人多渠道确认、不提供提供任何隐私

空投相关不轻易授权

平台插件只在官网下载、开启防火墙、浏览器插件权限管理

使用密码管理器为每个平台独立设置强密码

转账审计仔细地址

助记词只能离线保存、不上传发给任何人

定期检查钱包授权

然后web3合规直播部分

在文本、合同、协议、白皮书等法律文件上做到形式合法合规，使用符合监管的术语和表述

在业务模式、资金流向、用户交互等实际运营中规避法律风险，不做公开融资行为

入职前要详细调查、合同审查、业务隔离

安全方面做到不点、不签、不装、不转
<!-- DAILY_CHECKIN_2026-01-14_END -->

# 2026-01-13
<!-- DAILY_CHECKIN_2026-01-13_START -->




以太坊是一个去中心化、开源并且具备智能合约功能的公共区块链平台。EVM是一个图灵完备的虚拟机，能够执行智能合约代码，可以运行各类程序和应用。

以太坊具有几个特点：1smart contract 2dapp 3tokens 4PoS 5gas 6Proto-Danksharding与Dencun 7

gas费动荡原因：1网络拥堵 2全球用户活动时间差 3交互复杂程度

dapp核心技术特征：1去中心化 2确定性 3图灵完备 4隔离性

021上以太坊中心化实现机制中的部分不理解，查询后的内容如下

MEV与PBS（应对市场力量的集中化压力）

核心问题：最大可提取价值（MEV）会促使验证者专业化、中心化，以获取更高利润。

解决方案（PBS）：

-   职责分离：将“构建区块”（排序交易以获取MEV）和“提议区块”（最终确认区块）的角色分开。
    
-   构建者市场竞争：专业构建者之间为让自己的区块被选中而竞标，验证者只需选择收益最高的有效区块。
    
-   目的：防止验证者因追逐MEV而自然走向中心化，将排序权分散到一个竞争性市场中。当前的MEV-Boost是过渡方案，目标是最终通过协议升级（ePBS）将其内化。
    

今日学习的021学习以太坊部分内容和昨天的实习手册相重合
<!-- DAILY_CHECKIN_2026-01-13_END -->

# 2026-01-12
<!-- DAILY_CHECKIN_2026-01-12_START -->





区块链由多个区块组成，共同维护不可篡改的记录数据。

特点：不可篡改、公开透明、快速交易

BTC拥有区块链特性的同时具备货币属性，可以通过随机生成钱包地址进行交易。

区块链根据访问权限与治理模式，大致可分为三类：公链、联盟链、私链

去中心化的优势：信任最小化、抗审查与高弹性、用户自主管理、开放创新生态

Ethereum是通过ETH提供去中心化的EVM来处理点对点合约的。

ETH与BTC的差异

| 维度 | 比特币（Bitcoin） | 以太坊（Ethereum） |
| --- | --- | --- |
| 目标与定位 | 去中心化的数字货币，强调安全、稳定和稀缺性（总量 2100 万枚） | 去中心化平台，支持智能合约和 Dapps，定位为“区块链 2.0” |
| 编程能力 | 脚本语言有限，仅支持简单的交易验证逻辑 | 图灵完备的编程语言（如 Solidity），可开发复杂智能合约 |
| 共识机制 | 工作量证明（PoW），矿工通过算力竞争记账权 | 从 PoW 转向权益证明（PoS），通过 The Merge 实现能源效率优化 |
| 交易速度 | 每 10 分钟生成一个区块，交易确认较慢 | 区块时间约 12 秒，交易确认更快，适合高频应用 |
| 经济模型 | 总量固定，强调抗通胀属性 | 供应灵活，通过 EIP-1559 等机制可能呈现通缩趋势 |

以太坊历史：Pow -> The Merge -> PoS

1.  **The Merge（2022 年完成）**：从高能耗 PoW → 低能耗 PoS
    
2.  **EIP-4844（2024 年完成）**：让 L2 更便宜，普通人用得起
    
3.  **数据分片（2025-2026 年）**：进一步降低 L2 成本，提升整体扩展性
    

以太坊的生态系统由多层架构组成，包括 L1（主网）、L2（二层扩展解决方案）、侧链（Sidechains）

以太坊生态：应用层(defi/nft/wallet/dao)、协议层(共识层客户端、执行层客户端、核心协议)、扩展层(Layer2Rollups/侧链/状态通道)

gas是为了激励验证者以及防止资源滥用的
<!-- DAILY_CHECKIN_2026-01-12_END -->
<!-- Content_END -->
