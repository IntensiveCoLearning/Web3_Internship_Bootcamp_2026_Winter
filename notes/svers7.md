---
timezone: UTC+8
---

# 韩浩

**GitHub ID:** svers7

**Telegram:** @Svers

## Self-introduction

正在看我这篇自我介绍的同志，你好，我今年周岁24岁，本科软件工程，毕业已有两年，在玻璃行业从事轻度web2工作，在此想深入学习web3，从而能够提升自己，转到更大的平台，共勉。

## Notes

<!-- Content_START -->
# 2026-01-20
<!-- DAILY_CHECKIN_2026-01-20_START -->
# **第五章：EVM 与 Gas 机制**

## **第一部分：EVM —— 以太坊的“世界计算机”CPU**

你可以把整个以太坊网络想象成一台**遍布全球的、由成千上万台电脑（节点）共同维护的“世界计算机”**。这台计算机不能乱，每个人运行同一个程序必须得到一模一样的结果。谁来保证这一点？就是 **EVM**。

**1\. EVM 是什么？**

> **一句话背下来**：EVM 是以太坊虚拟机的缩写，它是一套**写在以太坊规则手册（黄皮书）里的、所有节点都必须遵守的代码执行说明书**。它规定了智能合约的每一条指令该如何运行、如何收费、如何改变账本状态。

**通俗理解**：

-   它不是一款像VMware那样的软件，而是一个**标准规范**。
    
-   就像全世界所有的DVD播放器都遵循同一套解码标准来播放光盘一样，所有以太坊节点（无论用Geth还是Nethermind软件）都遵循同一套EVM标准来“播放”（执行）智能合约。
    

**2\. EVM 的核心作用：确定性状态机**

-   **输入**：当前的“世界状态”（所有人的余额、所有合约的数据） + 一笔新交易。
    
-   **处理**：EVM 按照规则，执行交易里的代码。
    
-   **输出**：一个全新的、确定的“世界状态”。
    
-   **关键**：**确定性**！给定相同的输入，全世界的节点跑EVM，必须得到100%相同的输出。否则区块链就分叉乱套了。
    

**3\. EVM 内部有啥？（类比你的电脑）**

| EVM 组件 | 作用 | 通俗类比 |
| --- | --- | --- |
| 栈 (Stack) | 做计算的地方，比如加减乘除、临时放数字。 | CPU的寄存器。速度快，但地方小（只有1024层）。 |
| 内存 (Memory) | 临时存点数据，比如函数的参数、中间结果。 | 电脑的内存条(RAM)。这次交易执行完，数据就清空。 |
| 存储 (Storage) | 永久存储数据，比如你的代币余额、NFT归属。 | 电脑的硬盘。数据永久保存，但读写特别“贵”。 |
| 字节码 (Bytecode) | Solidity代码编译后变成的一串机器指令。 | CPU的指令集（比如x86指令）。EVM只认识这个。 |
| Gas计费器 | 盯着你的每一步操作，默默扣钱。 | 电表。你用电（计算），它就走字（扣Gas）。 |

* * *

## **第二部分：Gas —— 让“世界计算机”不瘫痪的“电费”机制**

如果执行代码是免费的，会怎样？黑客会写个死循环，让全世界的节点都帮他免费算到天荒地老，网络瞬间瘫痪。所以，必须收费！这个费用就是 **Gas**。

**1\. Gas 的本质是什么？**

-   Gas **不是一种代币**，它是一个**工作量单位**。就像“电”的单位是“度”，“计算”的单位是“Gas”。
    
-   你付的“电费”是 **ETH**。价格是：`总费用(ETH) = 消耗的Gas量 × Gas单价(Gwei)`
    

**2\. 为什么每步操作收费不同？（Gas定价表）** 因为不同操作消耗的“电力”（服务器资源）不同：

-   **便宜操作（几到几十Gas）**：比如算个加法 (`ADD`)，在栈里折腾一下。好比开个灯。
    
-   **昂贵操作（几百到几万Gas）**：
    
    -   **写存储 (**`SSTORE`**)**：最贵！因为要把数据永久写入区块链这个“全球硬盘”，所有节点都要同步保存。好比在数据中心新建一个文件并全球备份。
        
    -   **调用其他合约 (**`CALL`**)**：也不便宜，需要切换执行环境。好比让另一个部门的同事帮你干活，要协调沟通。
        
-   **动态调整**：历史上，如果发现某个操作太便宜被黑客用来攻击（DoS），社区就会通过升级（如柏林升级EIP-2929）给它**涨价**。Gas价目表是活的！
    

**3\. 两道安全锁：交易Gas上限 & 区块Gas上限**

-   **交易Gas上限 (Gas Limit)**：你发交易时自己设的。意思是“我为这笔交易最多愿意花这么多Gas”。如果执行到一半用光了，交易失败，**钱不退**（因为矿工已经为你付出了计算资源）。这防止了单笔交易无限循环。
    
-   **区块Gas上限 (Block Gas Limit)**：一个区块能容纳的所有交易Gas总和的上限。这防止了黑客用一堆重交易塞满单个区块，拖慢整个链。
    

* * *

## **第三部分：重大改革 —— 伦敦升级 (EIP-1559) 与新的“收费公路”模型**

以前的收费模式像**拍卖**：你猜一个价格（Gas Price），谁出价高，矿工先打包谁的。导致价格波动大，难以预测。

2021年伦敦升级后，变成了更聪明的 **“动态收费公路”** 模式：

**1\. 新费用结构：Base Fee（基础费） + Tip（小费）**

-   **Base Fee（基础费）**：
    
    -   由**系统自动计算**，根据最近区块的拥堵情况（车多不多）每块调整。
        
    -   **这笔钱直接被销毁（烧掉）**！不归矿工。这相当于给ETH增加了通缩压力。
        
    -   作用：**自动调节车流**。路堵了（交易多），基础费自动上涨，劝退不着急的用户；路空了，基础费下降，吸引用户。
        
-   **Tip（优先费/小费）**：
    
    -   你额外给矿工/验证者的小费，让他优先打包你的交易。你想多快，就加多少。
        
    -   这笔钱**归打包者**，是他们的主要收入之一。
        

**2\. 用户怎么操作？** 现在你不用猜价格了。钱包（如MetaMask）会告诉你：“当前基础费是15 Gwei，推荐小费2 Gwei，总单价17 Gwei，确认吗？” 你点确认就行，体验好多了。

**3\. 带来的核心变化**

-   **对用户**：手续费预估更准，体验提升。
    
-   **对ETH**：ETH变成了“有燃烧机制的资产”。网络用得越频繁，烧掉的ETH越多，可能抵消新增发的ETH，甚至导致总量减少（通缩）。
    

* * *

## **第四部分：当交易出问题 —— Gas耗尽与回滚**

**情景**：你调用一个合约，Gas设少了，执行到一半Gas用光了。

**结果**：

NaN.  **立即刹车**：EVM马上停止执行。
      
NaN.  **时光倒流**：这笔交易引起的**所有状态改变全部撤销**。余额没变，合约数据没改，就像什么都没发生过。
      
NaN.  **钱照扣**：已经消耗的Gas对应的ETH**不退**，支付给了矿工。**为什么？** 因为矿工确实为你工作了（执行到一半），不能让他白干。这也让“不断发起必定失败的复杂交易来攻击网络”变成一种极其烧钱的行为，划不来。
      
NaN.  **留下记录**：这条失败交易还是会记录在区块链上，状态是“Failed”。你可以看到它为什么失败（Out of Gas）。
      

**核心原则**：在以太坊，交易**要么完全成功，要么完全失败回滚**，没有中间状态。这保证了账本的一致性。

* * *

## **第五部分：实战指南 —— 如何写出省Gas的合约（省“电”秘籍）**

Gas费是用户掏的，但合约是你写的。写得烂，用户就得多付钱。以下是核心优化思路：

**原则一：能不用“硬盘”（Storage），就千万别用**

-   写一次存储 (`SSTORE`) 的Gas成本，够你做几千次加法。这是最大的开销。
    
-   **优化技巧**：
    
    -   **合并写入**：别在循环里一次次写Storage。先在内存里算好最终结果，最后只写一次。
        
    -   **Slot打包**：一个Storage位置有32字节。别只存一个`bool`（1字节）就占一个坑。可以把多个小数据（如`uint64`, `uint128`, `bool`）像拼积木一样拼在一个Slot里。
        
    -   **用事件代替存储**：如果有些数据只是为了记录历史（比如谁什么时候操作过），存到**事件(Event)**里，比写Storage便宜得多。
        

**原则二：选对“数据快递盒”**

-   函数参数，如果只读，一定用 `calldata`，别用 `memory`。`calldata` 是直接读原始数据，`memory` 会先复制一份，白花复制费。
    
-   函数内部，如果要频繁读取某个Storage变量，先把它**缓存到Memory变量**里。读内存比反复读Storage便宜得多。
    

**原则三：链上不做“重体力活”**

-   **避免未知长度的循环**：千万别写“遍历所有用户发奖”这种代码。Gas费会随着用户数爆炸。应该让用户自己来领（比如用Merkle证明），或者分批处理。
    
-   **复杂计算挪到链下**：把复杂的排序、统计在链下服务器算好，只把最终结果和证明（如签名）提交上链验证。链上只做简单的校验。
    

**原则四：利用好“免费”和“一次设定”的东西**

-   `constant` **(常量)** 和 `immutable` **(不可变量)**：在合约里固定不变的值（如协议地址、费率分母），用这两个关键字声明。它们不占Storage，直接编进字节码，用的时候不花钱。
    
-   **代理合约模式**：把合约的逻辑和存储分开。升级逻辑时，用户数据不用动，能省下巨额部署和迁移Gas。
    

**原则五：善用工具，数据说话**

-   用 **Hardhat Gas Reporter** 或 **Foundry** 的 `--gas-report` 功能，在测试时就能看到每个函数消耗多少Gas。
    
-   优化前和优化后跑一下，用数据证明你的改动真的省钱了，而不是靠感觉。
    

* * *

## **第六部分：EVM的生态与未来**

-   **EVM兼容链**：因为EVM太成功了，成了行业标准。所以像币安智能链(BSC)、Polygon、Arbitrum、Optimism等一大堆链都选择兼容EVM。这意味着你用Solidity写的合约，几乎不用改就能部署到这些链上，生态工具（MetaMask, Hardhat）也能直接用。这是以太坊生态强大的关键。
    
-   **挑战与演进**：
    
    -   **性能**：单条EVM链TPS有限，大家都在通过Layer 2 (Rollup) 把计算搬出去，主网只做安全和结算。
        
    -   **升级**：EVM本身也在缓慢进化（如EOF升级，让字节码更安全结构化），但因为要保证海量存量合约不出错，升级非常谨慎。
        

**终极总结**： **EVM** 是以太坊的**心脏和规则书**，它用确定的规则保证全球计算一致。 **Gas** 是以太坊的**血液和经济系统**，它用精密的定价防止网络滥用，并激励维护者。 理解它们，你就理解了以太坊如何能在去中心化的环境下，安全、可持续地运行无数个“自动程序”（智能合约）。这是区块链从“账本”进化到“可编程世界”的核心魔法。
<!-- DAILY_CHECKIN_2026-01-20_END -->

# 2026-01-19
<!-- DAILY_CHECKIN_2026-01-19_START -->

# **第五章：EVM 与 Gas 机制 详细笔记**

## **一、EVM：以太坊虚拟机**

-   **本质**：EVM是以太坊协议层定义的**确定性状态机**，是所有节点执行智能合约的统一运行时环境。
    
-   **核心作用**：
    
    -   **状态转换器**：输入旧状态（World State）和交易，通过执行字节码输出确定的新状态。
        
    -   **沙盒隔离**：合约在封闭环境中运行，无法访问节点本地文件系统或网络，保证安全与一致性。
        
-   **关键组件**：
    
    -   **栈**：深度1024的操作数栈，用于算术与逻辑运算。
        
    -   **内存**：临时字节数组，调用结束后释放。
        
    -   **存储**：永久的链上存储（Storage），读写成本高昂。
        
    -   **字节码**：Solidity等高级语言编译后的操作码序列，由EVM逐条解释执行。
        
-   **智能合约生命周期**：
    
    NaN.  **编写与编译**：高级语言 → 字节码 + ABI。
          
    NaN.  **部署**：通过一笔特殊交易（无`to`地址，data字段含创建字节码）将合约代码永久写入链上，生成合约地址。
          
    NaN.  **调用**：用户或合约向该地址发送交易，EVM根据Calldata中的函数选择器执行对应逻辑。
          
    NaN.  **状态更新与共识**：所有节点重复执行相同交易，确保状态一致后达成共识。
          

## **二、Gas机制：资源计量与经济模型**

-   **Gas的本质**：衡量EVM执行操作所需**计算资源**的抽象单位。
    
-   **为什么需要Gas？**
    
    NaN.  **防止滥用**：为每条操作码定价，使无限循环和复杂计算变得经济上不可行。
          
    NaN.  **激励节点**：支付Gas费用作为对矿工/验证者消耗算力与存储的补偿。
          
    NaN.  **精确计量**：不同操作成本不同（如`SSTORE`远贵于`ADD`），Gas模型反映真实资源消耗。
          
-   **费用计算**：
    
    -   **传统模型**：总费用 = `GasUsed` × `GasPrice`。
        
    -   **EIP-1559后模型**：
        
        -   `总费用 = GasUsed × (Base Fee + Priority Fee)`
            
        -   **Base Fee（基础费）**：协议根据网络拥堵动态计算，**直接被销毁**。
            
        -   **Priority Fee（小费）**：用户额外支付给打包者的激励。
            
        -   **最大费用约束**：用户设置`maxFeePerGas`和`maxPriorityFeePerGas`作为上限。
            

## **三、伦敦升级（EIP-1559）详解**

-   **核心变革**：
    
    -   **从第一价格拍卖到弹性底价**：手续费不再完全由用户竞价决定，引入协议计算的Base Fee作为必须支付的底价。
        
    -   **费用销毁**：Base Fee部分被永久销毁，使ETH在拥堵时可能进入**通缩**。
        
    -   **区块弹性容量**：区块Gas上限变为目标值的2倍，缓解短期拥堵。
        
-   **对各方影响**：
    
    -   **用户**：手续费预估更准确，体验提升。
        
    -   **开发者**：需适配新交易字段（`maxFeePerGas`），并可在合约内使用`BASEFEE`操作码。
        
    -   **ETH经济**：从纯粹通胀资产转变为“使用强度依赖型”的通胀/通缩混合资产。
        

## **四、Gas与安全性：防止攻击与滥用**

-   **多层防护**：
    
    NaN.  **指令级收费**：任何操作都有成本，杜绝免费资源消耗。
          
    NaN.  **交易Gas Limit**：单笔交易能消耗的资源有上限，防止单个无限循环拖垮节点。
          
    NaN.  **区块Gas Limit**：单个区块能包含的总工作量有上限，防止链级堵塞。
          
    NaN.  **动态定价与销毁**：EIP-1559使垃圾交易（Spam）成本随拥堵指数级上升，且部分费用被永久销毁，攻击代价高昂。
          
-   **历史升级的针对性调整**：
    
    -   通过多次硬分叉（如EIP-150, EIP-1884, EIP-2929）重定价被低估的操作码。
        
    -   削减Gas退款（EIP-3529）以防止状态膨胀和退款滥用攻击。
        

## **五、交易执行异常处理**

-   **Out of Gas（Gas耗尽）**：
    
    -   **结果**：交易执行立即停止，**所有状态更改回滚**。
        
    -   **费用**：已消耗的Gas**不予退还**，支付给出块者。这是防止“免费尝试攻击”的关键设计。
        
    -   **链上记录**：交易仍被打包进区块，状态标记为“失败”（Status=0）。
        
-   **其他异常**：如`REVERT`操作码被触发，同样会导致状态回滚，但允许返回错误信息。
    

## **六、合约Gas优化实战指南**

-   **核心思想**：**减少昂贵的链上操作，尤其是存储写入**。
    
-   **具体策略**：
    
    NaN.  **存储优化**：
          
          -   **合并写入**：在内存中完成计算，最后一次性写入Storage。
              
          -   **Slot打包**：将多个小整数（`uint64`、`bool`等）紧凑声明，使其共享一个32字节存储槽。
              
          -   **用事件替代存储**：仅用于记录的历史数据可存入事件（Log），成本更低。
              
    NaN.  **数据位置选择**：
          
          -   **优先**`calldata`：外部函数的只读参数使用`calldata`，避免复制到内存的成本。
              
          -   **缓存Storage到Memory**：在函数中多次读取的存储变量，应先缓存到内存变量。
              
    NaN.  **控制流与计算优化**：
          
          -   **避免链上大循环**：遍历未知长度数组极其昂贵，应设计为映射查找或链下计算+链上验证。
              
          -   **使用**`unchecked`**块**：在确保安全的前提下，对不会溢出的算术运算使用`unchecked`以节省Gas。
              
          -   **短路评估**：在条件语句中将廉价检查置于昂贵检查之前。
              
    NaN.  **合约架构优化**：
          
          -   **使用常量与不可变量**：`constant`和`immutable`变量不占存储，直接嵌入字节码。
              
          -   **代理与克隆模式**：使用代理合约（如ERC-1967）或最小代理（EIP-1167）来分离逻辑与存储，降低部署与升级成本。
              
          -   **利用新特性**：如EIP-1153的临时存储（`TSTORE`/`TLOAD`）适合存储单笔交易内的临时状态。
              
-   **优化验证**：必须使用工具（Hardhat Gas Reporter, Foundry Gas Snapshots, Tenderly）量化每次更改的Gas影响，避免主观臆断。
    

## **七、EVM的生态意义与局限**

-   **生态基石**：
    
    -   **标准化**：EVM已成为智能合约平台的事实标准，催生了庞大的多链兼容生态（如BNB Chain, Polygon, Arbitrum等）。
        
    -   **工具丰富**：整个开发工具链（Solidity, Hardhat, MetaMask等）围绕EVM构建，降低了开发门槛。
        
    -   **创新基础**：ZK-EVM、Layer 2 Rollup等扩容方案都建立在EVM语义之上。
        
-   **固有局限**：
    
    -   **性能瓶颈**：所有节点执行所有交易，限制了单链TPS。
        
    -   **状态膨胀**：存储数据永久积累，增加节点运行负担。
        
    -   **升级谨慎**：EVM规范的更改必须极度向后兼容，升级进程缓慢。
<!-- DAILY_CHECKIN_2026-01-19_END -->

# 2026-01-16
<!-- DAILY_CHECKIN_2026-01-16_START -->


以太坊是一个**可编程的全球分布式计算机**。它的核心框架可以概括为：

**一个平台**（第一章）：以太坊的核心定位是**去中心化的世界计算机**，通过**智能合约**和**EVM**实现程序化逻辑，使用**ETH**作为运行燃料（Gas）和系统安全抵押品，并已从能耗高的PoW全面转向PoS共识。

**一套网络**（第二章）：这台计算机由全球成千上万的**节点**共同维护。节点分为全节点、轻节点和归档节点，分工协作。网络采用**Gossip协议**和P2P通信来保证去中心化与信息同步。

**两类账户**（第三章）：与系统交互的入口是**账户**。**EOA**（外部账户）由私钥控制，是发起交易的主体；**合约账户**由代码控制，是智能合约的载体和状态存储者。两者共同构成了以太坊的所有交互基础。

**一种程序**（第四章）：智能合约是运行在这个平台上的**自动化程序**。它们通常用**Solidity**语言编写，编译后生成**字节码**和**ABI**，部署到链上获得一个永久地址。一旦部署，其逻辑通常不可更改，成为可公开验证、自动执行的“数字契约”。

**简单来说**：以太坊构建了一个由全球节点维护的**去中心化计算网络**。用户通过**私钥账户**发起交易，驱动部署在链上的**智能合约程序**自动执行，最终形成一个无需中介、可编程的信任与协作基础设施。
<!-- DAILY_CHECKIN_2026-01-16_END -->

# 2026-01-15
<!-- DAILY_CHECKIN_2026-01-15_START -->



# **《从零到一学习以太坊》第3-4章核心笔记**

## **第三章：账户类型与结构**

### **一、EOA（外部拥有账户）**

-   **定义**：由私钥直接控制的账户，可主动发起交易、持有ETH/代币。
    
-   **控制方式**：
    
    -   私钥签名交易，公钥派生地址（`0x`开头，20字节）。
        
    -   通过助记词（BIP-39）和分层确定性钱包（BIP-44）管理多个地址。
        
    -   **Nonce**：防止重放攻击，保证交易顺序。
        
-   **状态字段**（与合约账户相同结构）：
    
    -   `address`、`nonce`、`balance`、`storageRoot`、`codeHash`
        
    -   EOA的`codeHash`和`storageRoot`为空。
        

### **二、合约账户**

-   **定义**：由部署在链上的EVM字节码控制的账户，无私钥，不能主动发起交易。
    
-   **创建方式**：
    
    -   **CREATE**：地址由部署者地址 + nonce决定。
        
    -   **CREATE2**：地址可预先计算（`0xff + deployer + salt + keccak256(init_code)`）。
        
-   **能力**：
    
    -   可持有ETH/代币、存储状态变量、执行复杂逻辑。
        
    -   只能通过被EOA或其他合约调用执行。
        

### **三、EOA vs 合约账户对比**

| 特性 | EOA | 合约账户 |
| --- | --- | --- |
| 控制方式 | 私钥签名 | 智能合约代码 |
| 发起交易 | 能主动发起 | 只能被动响应调用 |
| 代码/存储 | 无代码，无存储 | 有代码和存储 |
| 升级能力 | 私钥不变即可 | 需通过代理模式升级 |
| 创建成本 | 低（只需签名） | 高（需支付部署Gas） |

### **四、地址格式与交互**

-   `0x`**前缀**：十六进制标识，非协议强制，为便于识别。
    
-   **EOA → 合约**：通过交易调用合约函数（`data`字段编码）。
    
-   **合约 → 合约**：通过`call`/`delegatecall`/`staticcall`内部调用。
    
-   **合约 → EOA**：可转账，但无法主动发起新交易。
    

### **五、扩展功能（多签、时间锁）**

-   **多签钱包**：需多个签名才可执行交易（如Gnosis Safe）。
    
-   **时间锁**：延迟敏感操作，用于治理升级或资金解锁。
    

### **六、ERC-20/ERC-721代币与合约**

-   代币本质是**合约内的记账系统**（如`_balances`映射）。
    
-   代币操作实为**调用代币合约的函数**（如`transfer`、`approve`）。
    

### **七、合约的不可篡改性与升级**

-   **默认不可变**：部署后代码无法直接修改。
    
-   **升级方案**：
    
    -   代理模式（Proxy）：逻辑合约可更换，状态保持不变。
        
    -   **SELFDESTRUCT**：EIP-6780后仅在创建交易内有效，不再推荐用于升级。
        

* * *

## **第四章：智能合约理论基础**

### **一、智能合约概念与功能**

-   **定义**：部署在区块链上的自动化程序，条件触发自动执行。
    
-   **核心价值**：
    
    -   **去信任化**：无需中介，代码即规则。
        
    -   **确定性**：相同输入 → 相同输出。
        
    -   **透明可审计**：所有执行记录公开上链。
        
    -   **可编程性**：支持复杂业务逻辑（DeFi、NFT、DAO等）。
        

### **二、Solidity语言特性与优势**

-   **EVM原生**：专为EVM设计，编译为字节码。
    
-   **语法友好**：类似JavaScript/C++，支持继承、库、事件等。
    
-   **生态成熟**：
    
    -   工具链：Hardhat、Foundry、Remix、OpenZeppelin。
        
    -   安全工具：Slither、Mythril、审计服务。
        
-   **安全增强**：
    
    -   0.8.x默认开启溢出检查。
        
    -   支持`reentrancy guard`、`pull payment`等模式。
        

### **三、合约编译产出**

NaN.  **字节码（Bytecode）**：
      
      -   **创建字节码**：包含构造函数逻辑，部署时执行。
          
      -   **运行字节码**：部署后存储在链上的可执行代码。
          
NaN.  **ABI（应用二进制接口）**：
      
      -   JSON文件，描述合约函数、事件、参数格式。
          
      -   用于前端/其他合约正确编码/解码调用。
          
NaN.  **元数据（Metadata）**：
      
      -   包含编译器版本、源码哈希、ABI等信息。
          
      -   用于合约验证（Etherscan/Sourcify）。
          
NaN.  **其他中间表示**：
      
      -   AST（抽象语法树）、源映射、Yul IR、EVM汇编代码。
          

### **四、合约部署与交互**

-   **部署流程**：
    
    NaN.  编译生成字节码 + ABI。
          
    NaN.  发送创建合约交易（`to`为空，`data`为字节码）。
          
    NaN.  获得合约地址（由部署者地址 + nonce 或 CREATE2 计算）。
          
-   **交互方式**：
    
    -   前端通过ABI + 地址调用合约函数。
        
    -   区块浏览器验证源码后提供“读写合约”界面。
        

### **五、合约核心组件**

| 组件 | 说明 |
| --- | --- |
| 状态变量 | 持久化存储在链上的数据（可public/private） |
| 函数 | 可修改状态、返回结果（支持pure/view/payable） |
| 事件 | 用于日志记录，外部可监听 |
| 构造函数 | 仅在部署时执行一次 |
| 修饰符 | 可复用的条件检查逻辑（如onlyOwner） |
| 结构体/枚举 | 定义复杂数据类型与状态枚举 |
| 自定义错误 | 更高效的错误提示（替代require字符串） |
<!-- DAILY_CHECKIN_2026-01-15_END -->

# 2026-01-14
<!-- DAILY_CHECKIN_2026-01-14_START -->




# **Web3安全与合规指南笔记**

## **1\. 核心：中国监管环境与法律风险**

中国对虚拟货币及相关金融活动持严格限制态度，监管基调是 **“全面封堵金融属性，有限容忍技术创新”**。

### **1.1 主要禁令政策**

-   禁止ICO（首次代币发行）、IEO、IDO等任何形式的代币融资活动。
    
-   禁止虚拟货币交易所运营及提供撮合服务。
    
-   明确虚拟货币不具有法偿性，不得作为支付工具。
    
-   禁止境外交易平台向中国境内居民提供服务。
    
-   打击利用虚拟货币进行的非法集资、传销、洗钱、赌博等活动。
    

### **1.2 关键法律风险领域**

| 风险领域 | 具体情形与风险 |
| --- | --- |
| 代币发行与交易 | 任何具备融资功能或可流通性的代币发行都可能构成非法金融活动（如非法吸收公众存款罪），技术人员参与开发也无法以“只是写代码”为由免责。 |
| 涉赌风险 | 项目若存在“充值-抽奖-提现”闭环，可能被认定为“开设赌场罪”。具有提现功能是涉赌应用的显著特征。 |
| 传销风险 | 项目经济模型中如含“邀请返利”、“多级推广”等团队计酬模式，可能触犯组织、领导传销活动罪。 |
| 场外交易风险 | 通过虚拟货币进行“地下换汇”可能构成非法经营罪。若交易资金涉及黑产，可能被控洗钱罪或掩饰隐瞒犯罪所得罪。 |
| 民商事争议 | 涉及虚拟货币买卖、委托投资的合同，在中国法院很可能被认定为无效，导致“风险自担”，损失难以追回。 |

## **2\. 全球监管趋势概览**

全球正逐步建立加密资产监管框架，合规化是明确趋势。

### **2.1 核心监管机构与框架**

-   **FATF（金融行动特别工作组）**：制定全球反洗钱(AML)标准，其 **“旅行规则”(Travel Rule)** 要求虚拟资产服务商在转账时收集并传输用户信息，对DeFi和DEX构成合规挑战。
    
-   **稳定币监管**：因系统性风险（如Terra UST崩盘）和货币政策影响，成为监管重点。监管目标在于确保储备资产充足、维护金融稳定及反洗钱。
    
-   **主要地区监管**：
    
    -   **美国**：SEC（证监会）将多数代币视为证券监管；CFTC（商品期货委员会）监管加密货币期货。
        
    -   **欧盟**：**MiCA法规**（已生效）是全球首个全面的加密货币监管框架，对稳定币有严格储备要求，并禁止算法稳定币。
        
    -   **香港**：已实施虚拟资产服务提供商(VASP)牌照制度，并对零售投资者开放交易。
        

## **3\. Web3入职风险防范（针对求职者）**

Web3领域新型的雇佣关系与传统行业差异巨大，需审慎评估。

### **3.1 雇佣关系与薪酬风险**

| 风险点 | 具体说明与防范建议 |
| --- | --- |
| 劳动关系模糊 | 项目多在境外注册，可能无法签订国内有效的《劳动合同》及缴纳社保公积金，影响落户、购房、贷款等权益。入职前需评估能否接受。 |
| 薪酬结构风险 | “人民币+Token”或“全USDT”薪酬可能不符合《劳动法》以法定货币支付的规定。Token价值波动大甚至归零，会直接影响收入。建议与公司协商保留部分法币薪酬。 |
| 虚拟货币出金风险 | 将薪酬虚拟币兑换为人民币时，若交易对手资金涉诈涉赌，可能导致银行卡冻结甚至承担刑事责任。务必通过可信渠道交易，并保留资金来源记录。 |
| 项目合法性风险 | 即使作为员工，若所在项目整体涉嫌非法金融活动，也可能被牵连。入职前应主动审查项目白皮书、代币模型、是否面向中国大陆用户等。 |

### **3.2 刑事风险提示：属人管辖原则**

中国刑法不仅适用属地管辖，也适用**属人管辖**。即中国公民在境外从事中国刑法所禁止的犯罪活动（如开设赌场、非法经营），中国司法机关依然拥有管辖权。

## **4\. 刑事案例警示：BigGame开设赌场案**

-   **案情**：2018-2020年，谢某非、刘某功等人在EOS区块链上开发运营BigGame赌博平台，提供“掷骰子”等游戏，赌资累计3.3亿余EOS。
    
-   **判决**：法院认定10名被告均构成**开设赌场罪**。两名主犯（负责运营、技术）分别被判处有期徒刑五年九个月和四年六个月，并处罚金；其余8名从犯（负责产品设计、代码编写、客服推广等）均被判处有期徒刑并适用缓刑，同时处罚金。
    
-   **核心启示**：在涉嫌犯罪的项目中，**不仅是组织者和运营者，连负责产品设计、代码编写、客服推广等环节的技术和工作人员，也会被认定为共犯（从犯）并承担刑事责任**。
    

> **总结要点**：对于中国从业者而言，参与Web3项目必须将**合规置于首位**，深刻理解境内外的监管红线，审慎评估项目性质与个人职责，避免因追求技术创新或经济利益而触碰法律底线。
<!-- DAILY_CHECKIN_2026-01-14_END -->

# 2026-01-13
<!-- DAILY_CHECKIN_2026-01-13_START -->





### **以太坊核心机制与架构学习笔记**

**一、 基础认知：什么是以太坊？**

以太坊是一个**全球性、去中心化的状态机**（可编程的区块链），其核心是运行**智能合约**的**以太坊虚拟机（EVM）**。它不仅是数字货币（ETH），更是一个**无需信任的计算平台**。

**二、 核心演变：从PoW到PoS**

这是理解现代以太坊的基础，两种机制在哲学和实现上截然不同。

| 对比维度 | 工作量证明 (PoW - 已淘汰) | 权益证明 (PoS - 当前使用) |
| --- | --- | --- |
| 核心资源 | 物理算力与电力（能源消耗） | 质押的ETH资本（经济质押） |
| 参与者 | 矿工 | 验证者（需质押32 ETH） |
| 竞争方式 | 所有矿工进行哈希计算竞赛，赢者通吃。 | 算法随机选择区块提议者，概率与质押量成正比。 |
| 安全性基础 | 篡改历史需拥有 >51% 全网算力，物理成本极高。 | 篡改历史需控制 >66% 质押ETH，资产会被罚没，经济成本毁灭性。 |
| 关键角色 | 获胜矿工全权打包并确认区块。 | 提议者打包区块，验证者委员会投票确认，权力分离。 |

**三、 核心支柱详解**

**1\. 执行层：智能合约与EVM**

-   **智能合约**：部署在链上的程序，代码即法律，自动执行。
    
-   **EVM**：全球所有节点运行的标准虚拟机，确保合约执行结果一致。
    
-   **Gas**：衡量计算/存储资源的单位。用户支付ETH作为Gas费，旨在为网络资源定价并防止垃圾交易。
    

**2\. 共识层：PoS与委员会机制**

-   **质押与验证者**：质押32 ETH可成为一个验证者。质押越多，验证者单元越多。
    
-   **提议者**：每个时隙（12秒）被随机选出一个，负责打包新区块。
    
-   **验证者委员会**：随机抽选数百名验证者组成，对提议的区块进行**投票**。需超过2/3赞成票，区块才能被最终确认。
    
-   **核心逻辑**：委员会机制确保 **“提议权”与“确认权”分离**。大户可能更常成为提议者，但无法控制委员会投票，从而无法单方面作恶。
    

**3\. 安全与惩罚机制**

-   **51%攻击 (PoW) / 66%攻击 (PoS)**：理论上控制大部分资源可篡改历史，但因物理/经济成本高到不现实，实际中几乎不可能。
    
-   **罚没**：PoS中的核心反制措施。验证者若作恶（如双重投票）或严重失职，其质押的ETH将被部分或全部销毁。
    
-   **反相关惩罚**：如果多个验证者（通常属于同一实体）**同时犯相同错误**，惩罚会指数级放大。这**强制大户必须分散部署节点**，否则将面临毁灭性损失，从而对抗中心化。
    

-   **分层协作**：用户操作触发交易，由**执行客户端**在**EVM**中处理，由**共识客户端**通过**PoS**机制与全网节点达成共识，最终更新全局状态。
    
-   **关键升级**：“合并”后，架构明确分为**执行层**和**共识层**，通过“引擎API”通信，提升了系统的模块化和可升级性。
    

**四、 关键概念辨析**

-   **矿工 vs. 验证者/提议者**：矿工是PoW时代的产物，通过算力竞争获得记账权；验证者是PoS时代的参与者，通过质押和随机选择获得提议权。
    
-   **概率优势 vs. 控制权**：在PoS中，质押多意味着被选为**提议者**的概率大（获得奖励的机会多），但绝不等于能控制**委员会投票**结果或篡改网络。
    
-   **难度调整 (PoW)**：算法根据过去区块的出块时间，自动调整挖矿难度以维持稳定出块速度。规则写死在客户端代码中，任何个体无法篡改。
<!-- DAILY_CHECKIN_2026-01-13_END -->

# 2026-01-12
<!-- DAILY_CHECKIN_2026-01-12_START -->






### **一、区块链基础概念**

区块链的定义（一种由区块按时间顺序串联而成的分布式账本）及其**不可篡改、公开透明、去中心化**等特性；区分了**比特币**作为激励和价值载体的角色；对比了**公链、联盟链、私链**三种类型在访问权限和管理模式上的差异；辨析了**Web2、Web3与Web 3.0**（语义网）的根本不同，并探讨了去中心化的优势与挑战。

### **二、以太坊概览**

将以太坊定位为“**区块链2.0**”和“**世界计算机**”，其最关键的创新是引入了**智能合约**。对比了以太坊与比特币的差异，重点阐述了从**工作量证明（PoW）到权益证明（PoS）** 的“合并”升级及其意义，并勾勒了未来的分片等扩容路线。此外，还概述了以太坊的**多层生态**（L1主网、L2扩展方案）和其**去中心化、开放、抗审查**的文化价值观。

### **三、行业赛道全览**

介绍了Web3的四大核心应用领域，通过典型案例进行剖析：

-   **DeFi**：以 **Uniswap**（去中心化交易所，采用自动做市商模式）、**Compound**（借贷协议）和 **MakerDAO**（超额抵押生成稳定币）为例，展示了如何去除传统金融中介。
    
-   **NFT**：强调了其作为**数字所有权唯一凭证**的本质，并介绍了 **CryptoPunks**（开创性项目）和 **OpenSea**（主流交易平台）。
    
-   **DAO**：介绍了**去中心化自治组织**的理念，例举了 **Nouns DAO**（社区驱动的NFT项目）和 **ConstitutionDAO**（轰动一时的众筹案例），展示了社区共治的模式。
    

### **四、Web3工作方式（远程工作指南）**

这是一份面向Web3从业者的远程协作实用指南。**内容分为两部分**：

1.  **常用工具**：列举并简要介绍了 **Twitter（X）、Telegram、Discord、MetaMask** 等社交媒体、通讯、钱包工具，以及 **Notion、Zoom、Calendly、Figma、GitHub** 等办公协作工具，其中特别强调了Telegram使用的**安全防范措施**。
    
2.  **协作习惯**：重点介绍了用 **OKR**（目标与关键结果）方法进行目标管理，并提供了如何高效组织**远程会议**（包括预约技巧和会议纪律）以及提升职场**软技能**（如排版）的建议。
<!-- DAILY_CHECKIN_2026-01-12_END -->
<!-- Content_END -->
