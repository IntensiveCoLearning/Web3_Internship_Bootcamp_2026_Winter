---
timezone: UTC+8
---

# ClaudiaXu

**GitHub ID:** ClaudiaXuzq

**Telegram:** 

## Self-introduction

Web3 实习计划 2025 冬季实习生

## Notes

<!-- Content_START -->
# 2026-01-23
<!-- DAILY_CHECKIN_2026-01-23_START -->
# Web3 实习计划（冬季）：Uniswap 工作原理解析

-   **Title**: Uniswap 工作原理解析
    
-   **Author**: JF 老师 / ETHPanda
    
-   **URL**: \[源视频链接未提供\]
    

\--------------------------------------------------------------------------------

## 概览 (Overview)

本课程报告深入解析了去中心化交易所（DEX）巨头 Uniswap 的核心工作原理，旨在为对 DeFi 领域感兴趣的开发者和学习者提供一份详尽、可反复学习的技术讲义。报告以 Uniswap V2 为起点，系统性地阐述了恒定乘积做市商（CPMM）模型的基础，即 `x * y = k` 公式的数学原理与实际应用。通过具体的交易和套利案例，报告详细拆解了价格发现、流动性深度、价格影响（Price Impact）与滑点（Slippage）之间的区别，并对流动性提供者（LP）面临的关键挑战——无常损失（Impermanent Loss）——进行了深入的量化分析。随后，报告介绍了 V2 中精巧的链上预言机设计，即时间加权平均价格（TWAP）机制。课程的核心内容聚焦于 Uniswap V3 的革命性创新——集中流动性（Concentrated Liquidity）。报告清晰地阐述了 V3 如何解决 V2 资本效率低下的问题，并深入探讨了其背后复杂的数学模型（`L` 与 `√P`）、价格离散化机制（Ticks），以及为实现高效计算而设计的精巧数据结构与费用分配算法。最终，报告旨在帮助读者构建一个从 V2 的简单被动模型到 V3 的高效主动模型的完整认知框架，理解 Uniswap 协议演进背后的设计哲学与技术权衡。

\--------------------------------------------------------------------------------

## 主题拆解

### Section 1：Uniswap V2 核心机制：恒定乘积做市商 (00:00:00)

Uniswap V2 是理解自动化做市商（Automated Market Maker, AMM）的基石。其核心机制被称为**恒定乘积做市商 (Constant Product Market Maker, CPMM)**。这个模型摒弃了传统金融中的订单簿模式，转而使用一个简单的数学公式来确定资产价格和促成交易。

**1.1 核心公式：x \* y = k**

所有基于 CPMM 的交易都围绕着 `x * y = k` 这个公式展开。

-   **x**: 池中资产 A 的数量。
    
-   **y**: 池中资产 B 的数量。
    
-   **k**: 一个恒定的乘积（Constant Product）。在不考虑增加或移除流动性的情况下，`k` 值在交易过程中保持不变。
    

这条公式在坐标系中绘制出来是一条双曲线。池子里的任何交易都相当于在这条曲线上移动。

**1.2 价格发现机制**

在 Uniswap V2 中，资产的瞬时价格（Price, P）并非外部输入，而是由池中两种资产的比例决定的。

-   **价格公式**: `P = y / x`
    

这意味着，资产 y 相对于资产 x 的价格，就是 y 的储备量除以 x 的储备量。

**【案例演算 1：计算 k 值与初始价格】**

假设一个流动性池中包含以太坊（ETH）和 USDC 两种资产：

-   **x (ETH)** = 2 个
    
-   **y (USDC)** = 6000 个
    

根据上述公式，我们可以计算出：

-   **k 值**: `k = x * y = 2 * 6000 = 12000`
    
-   **初始价格 (P)**: `P = y / x = 6000 / 2 = 3000 USDC/ETH`
    

此时，ETH 的价格是 3000 USDC。

**1.3 套利与价格调整**

AMM 的价格依赖外部套利者（Arbitrageurs）来与市场保持一致。当 AMM 池内价格与其他交易所（如 Binance）出现价差时，套利机会便产生。

**【案例演算 2：套利场景分析】**

延续上例，池内 ETH 价格为 3000 USDC。假设此时 Binance 上的 ETH 价格上涨到了 3200 USDC。套利者会执行以下操作：在 Uniswap 池中以低于 3200 的价格买入 ETH，然后在 Binance 上以 3200 的价格卖出，赚取差价。

这个套利行为会改变 Uniswap 池内的资产储备，从而使其价格向 3200 靠拢。我们需要计算的是，要将池内价格推高到 3200，需要进行怎样的交易。

-   **目标**:
    
    1.  交易后的新价格 `P' = y' / x' = 3200`
        
    2.  交易后依然满足恒定乘积 `x' * y' = k = 12000`
        
-   **求解步骤**:
    
    1.  我们有两个方程和两个未知数 (`x'`, `y'`)。
        
    2.  从 `y' / x' = 3200` 可得 `y' = 3200 * x'`。
        
    3.  将 `y'` 代入 `x' * y' = 12000`，得到 `x' * (3200 * x') = 12000`，即 `3200 * (x')^2 = 12000`。
        
    4.  解得 `(x')^2 = 12000 / 3200 = 3.75`，因此 `x' ≈ 1.9365`。
        
    5.  再计算 `y' = 12000 / 1.9365 ≈ 6196.77`。
        
-   **结果分析**:
    
    -   **交易前**: `x = 2` ETH, `y = 6000` USDC
        
    -   **交易后**: `x' = 1.9365` ETH, `y' = 6196.77` USDC
        
    -   **交易过程**: 套利者向池中放入了 `delta_y = y' - y = 6196.77 - 6000 = 196.77` USDC，并从中取走了 `delta_x = x - x' = 2 - 1.9365 = 0.0635` ETH。
        

套利者用 196.77 USDC 换到了 0.0635 ETH，其平均成交价为 `196.77 / 0.0635 ≈ 3098` USDC/ETH。这个价格介于初始价格 3000 和目标价格 3200 之间。套利者随后可以将这 0.0635 ETH 在 Binance 以 3200 的价格卖出，完成套利。

**1.4 通用交易公式与手续费**

对于任意一笔交易，即用 `delta_x` 数量的资产 X 换取 `delta_y` 数量的资产 Y，其关系必须满足： `(x + delta_x) * (y - delta_y) = k`

通过展开和简化（消去 `x*y = k`），可以推导出 `delta_x` 和 `delta_y` 的通用计算公式。

**手续费机制**: 实际交易中，交易者需要向流动性提供者（LP）支付手续费。在 Uniswap V2 中，这笔费用（通常为 0.3%）是在交易输入端扣除的。公式会进行如下修正：

`(x + delta_x * (1 - fee)) * (y - delta_y) = k`

这意味着，用户提供的 `delta_x` 并非全部用于兑换 `delta_y`，其中一小部分（`delta_x * fee`）会作为手续费留在池中，实质上增加了 `k` 值，从而奖励了 LP。

**1.5 闪电兑换 (Flash Swaps)**

Uniswap V2 的 `swap` 函数实现了一个独特的机制，这构成了闪电兑换（或闪电贷）的基础。其执行顺序如下：

1.  **乐观转出**: 合约首先将用户请求的输出代币（`delta_y`）发送给调用者。
    
2.  **回调函数**: 然后，合约会调用用户指定的一个回调函数（callback function）。
    
3.  **用户操作**: 在回调函数中，用户可以利用刚刚收到的代币进行任意操作（例如，在其他协议中进行清算或套利）。
    
4.  **偿还输入**: 在回调函数执行结束前，用户必须将应付的输入代币（`delta_x`）转回给 Uniswap 池。
    
5.  **最终检查**: 回调结束后，Uniswap 合约会检查池中资产，验证 `x * y >= k` 的不变量是否仍然成立。如果不成立，整笔交易将回滚（revert）。
    

这个“先付后款”的模式极为强大，因为它允许用户在**不持有任何初始资本**的情况下，在一笔原子交易（atomic transaction）内完成复杂的套利和清算操作，极大地提高了资本利用效率。

\--------------------------------------------------------------------------------

### Section 2：Uniswap V2 深度解析：流动性、价格影响与无常损失 (XX:XX:XX)

**2.1 流动性深度与价格曲线**

流动性提供者（LP）通过向池中同时存入两种资产来提供流动性。此举会影响 `k` 值。

-   **增加流动性**: LP 必须按当前池内资产的比例存入两种资产，这会使得 `k` 值变大，价格曲线向外平移。此操作**不应改变当前价格**。
    
-   **移除流动性**: LP 按比例取走两种资产，`k` 值变小，价格曲线向内收缩，同样**不改变当前价格**。
    

`k` 值的大小直接代表了**流动性深度 (Pool Depth)**。在可视化的图表上，不同的 `k` 值对应着一系列平行的双曲线。从原点画出的一条直线（代表一个固定的价格）会与这些曲线相交，所有交点的斜率相同，意味着价格相同。

流动性深度的影响：

-   **深池 (k 值大)**: 推动价格变动相同的幅度需要更大规模的交易。对于交易者来说，可以兑换更多的代币，价格也更稳定。
    
-   **浅池 (k 值小)**: 即使是小额交易也可能导致剧烈的价格变动。
    

**2.2 价格影响 (Price Impact) vs. 滑点 (Slippage)**

这两个概念经常被混淆，但它们有本质区别。

-   **价格影响 (Price Impact)**:
    
    -   这是一个**可预测、确定性**的结果。
        
    -   它源于 `x * y = k` 曲线的内在特性。任何交易都会消耗池中一种资产的储备，增加另一种，从而沿着曲线移动到一个新的价格点。
        
    -   交易规模越大，相对于池子深度而言，价格移动的幅度就越大，平均成交价就越差。这部分价差就是价格影响。**池子越深，价格影响越小**。
        
-   **滑点 (Slippage)**:
    
    -   这是一个**不可预测、非确定性**的风险。
        
    -   它发生在用户提交交易到交易被矿工打包上链之间的这段时间里。
        
    -   原因可能包括：MEV 攻击（如三明治攻击）或有其他人的交易在你之前成交，改变了池子的状态。
        
    -   例如，你预期以 3100 的价格成交，但由于有人抢跑，你最终的成交价变成了 3110。这 10 美元的价差就是滑点。
        

为了控制滑点风险，所有 DEX 都允许用户设置一个**最大滑点容忍度 (Max Slippage Tolerance)**。如果最终成交价超出了这个容忍范围，交易就会失败回滚。

**2.3 无常损失 (Impermanent Loss, IL)**

这是流动性提供者（LP）面临的一个核心风险，也是 AMM 设计中一个难以规避的特性。

**【案例演算 3：无常损失的计算】**

我们再次使用 ETH 价格从 3000 USDC 变为 3200 USDC 的例子，但这次从 LP 的视角来分析。

-   **初始状态 (作为 LP)**:
    
    -   向池中存入 2 ETH 和 6000 USDC。
        
    -   初始总价值 = `(2 * 3000) + 6000 = 12000` USDC。
        
-   **价格变化后 (作为 LP)**:
    
    -   经过套利交易，池内资产变为 `1.9365` ETH 和 `6196.77` USDC。
        
    -   此时总价值 = `(1.9365 * 3200) + 6196.77 ≈ 12393.57` USDC。
        
    -   LP 看起来赚了 `12393.57 - 12000 = 393.57` USDC（未计算手续费收入）。
        
-   **对比：如果不做 LP，只是持有资产 (HODL)**:
    
    -   初始持有 2 ETH 和 6000 USDC。
        
    -   价格变化后，资产价值为 = `(2 * 3200) + 6000 = 6400 + 6000 = 12400` USDC。
        
-   **无常损失计算**:
    
    -   `IL = HODL 价值 - LP 价值 = 12400 - 12393.57 = 6.43` USDC。
        
    -   这意味着，尽管 LP 的资产以美元计价是增值的，但相对于简单持有原始资产，他反而“少赚了”。这种机会成本的损失就是无常损失。
        

**核心特性**:

-   **“无常”的来源**: 如果未来市场价格从 3200 回归到 3000，LP 池中的资产比例也会回到最初的 2 ETH 和 6000 USDC，此时 IL 消失。
    
-   **根本原因**: LP 实际上是被动地在价格上涨时卖出表现好的资产（ETH），在价格下跌时买入表现差的资产，这是一种逆向选择的结果。
    
-   **补偿**: AMM 通过手续费收入来补偿 LP 所承担的无常损失风险。
    

**无常损失公式**: 一个常用的计算 IL 的公式如下，其中 `price_ratio` 是价格变化的比例（例如，从 3000 到 3200，`price_ratio = 3200/3000`）。 `IL = (2 * sqrt(price_ratio) / (1 + price_ratio)) - 1`

\--------------------------------------------------------------------------------

### Section 3：Uniswap V2 的预言机功能：时间加权平均价格 (TWAP) (XX:XX:XX)

除了交易功能，Uniswap V2 还提供了一个强大的、抗操纵的链上价格预言机（On-chain Oracle）。它采用的是**时间加权平均价格 (Time-Weighted Average Price, TWAP)** 机制。

**3.1 机制原理**

直接使用 AMM 的瞬时价格 (`y/x`) 作为预言机是极不安全的，因为它容易在单笔交易中被闪电贷等方式操纵。TWAP 巧妙地解决了这个问题。

-   **累积价格存储**: Uniswap V2 合约并不直接记录价格，而是维护一个**累积价格 (Cumulative Price)** 变量。
    
-   **计算方式**: 每当池中发生交易时，合约会用**交易前的价格**乘以**自上次价格更新以来经过的时间**，并将这个乘积（代表一个“价格-时间”面积）累加到累积价格变量上。
    

`CumulativePrice_t = CumulativePrice_{t-1} + Price_{t-1} * (t - (t-1))`

**3.2 如何使用 TWAP**

要计算某个时间段 `[T0, T1]` 内的时间加权平均价格，需要进行两次读取：

1.  在时间点 `T0`，读取当时的累积价格值 `V0`。
    
2.  在时间点 `T1`，再次读取累积价格值 `V1`。
    

**TWAP 计算公式**: `TWAP_[T0, T1] = (V1 - V0) / (T1 - T0)`

这个结果 `(V1 - V0)` 代表了从 `T0` 到 `T1` 这段时间内价格曲线下方的总面积，再除以时间差 `(T1 - T0)`，就得到了这段时间的平均价格。

**3.3 优点与局限**

-   **优点**:
    
    -   **抗操纵性强**: 操纵 TWAP 需要在很长一段时间内持续影响价格，这使得攻击成本非常高昂。
        
    -   **Gas 高效**: 合约只需在每次交易时更新一个存储变量，计算逻辑简单。
        
-   **局限**:
    
    -   需要两次链上读取操作，不能在单笔交易中即时获取最新的平均价格。
        

\--------------------------------------------------------------------------------

### Section 4：Uniswap V3 的革命：集中流动性 (Concentrated Liquidity) (XX:XX:XX)

Uniswap V3 是对 V2 模型的一次彻底革新，其核心是**集中流动性 (Concentrated Liquidity)**，旨在解决 V2 资本效率低下的问题。

**4.1 V2 的资本效率问题**

在 V2 的 `x * y = k` 模型中，流动性被均匀地分布在从 0 到无穷大的整个价格曲线上。这意味着 LP 提供了资本去支持极端且几乎不可能发生的价格区间（例如，ETH 价格为 3 美元或 300 万美元）。大部分资本处于闲置状态，无法赚取手续费，导致资本效率极低。

**4.2 V3 的核心思想**

V3 允许流动性提供者（LP）将他们的资本**集中在特定的价格区间** `[Pa, Pb]` **内**。

-   **主动管理**: LP 可以根据自己对市场价格的预期，选择一个他们认为最有可能发生交易的窄幅区间来提供流动性。
    
-   **提高资本效率**: 在这个选定的区间内，LP 的资本可以实现比 V2 高出数百甚至数千倍的效率。同样数量的资本，在更窄的区间内可以提供更深的流动性。
    
-   **对交易者的好处**: 更深的流动性意味着更低的价格影响，交易者可以获得更好的成交价格。
    
-   **对 LP 的好处**: LP 的资本更集中于活跃交易区域，能够捕获更多的手续费。
    

**4.3 可视化理解**

我们可以从另一个视角来理解流动性：一个以价格为横轴、流动性深度为纵轴的图表。

-   **V2 的流动性**: 是一条从 0 到无穷远的水平直线，表示在任何价格点，流动性深度都是恒定的。
    
-   **V3 的流动性**: 是由多个不同 LP 提供的、在不同价格区间上的“矩形”流动性叠加而成。这会形成一个阶梯状的、不均匀的流动性分布图。在某些热门价格区间，流动性会非常深厚。
    

当交易发生，价格在这些区间内移动时，它实际上是在与由不同 LP 聚合起来的、深度不断变化的流动性进行交互。

\--------------------------------------------------------------------------------

### Section 5：Uniswap V3 的数学魔法：L 与 √P (XX:XX:XX)

为了实现集中流动性，V3 必须抛弃 V2 中简单的 `x*y=k` 状态变量，引入一套全新的数学框架。因为在 V3 中，当价格跨越不同 LP 设置的区间边界时，有效的流动性（相当于 `k` 值）是会发生变化的。

**5.1 新的状态变量**

V3 合约不再直接追踪池中的资产数量 `x` 和 `y`，而是追踪两个新的“虚拟”值：

-   **流动性 (Liquidity, L)**: `L = sqrt(k)`
    
-   **价格的平方根 (sqrt\_price, √P)**: `√P = sqrt(P) = sqrt(y/x)`
    

`L` 代表了在一个特定价格区间内的流动性总量。只要价格在该区间内变动，`L` 保持不变。

**5.2 新的交易计算公式**

基于 `L` 和 `√P`，交易量的计算变得异常简洁，并且不再直接依赖 `x` 和 `y`。

-   **计算** `delta_y`: `delta_y = L * delta(√P)`
    
-   **计算** `delta_x`: `delta_x = L * delta(1/√P)`
    

这里的 `delta` 指的是价格变动前后的差值。这些公式优雅地将流动性 `L` 和价格 `√P` 的变化分离开来，使得在流动性恒定的区间内计算交易量变得非常高效。

**【公式证明示例：验证** `delta_y` **公式】**

1.  从 `delta_y = L * delta(√P)` 出发，可得 `L = delta_y / delta(√P)`。
    
2.  `delta_y = y1 - y0`，`delta(√P) = √P1 - √P0`。
    
3.  所以 `L = (y1 - y0) / (√P1 - √P0)`。
    
4.  将 `√P` 用 `sqrt(y/x)` 替换，`L = (y1 - y0) / (sqrt(y1/x1) - sqrt(y0/x0))`。
    
5.  同时，我们知道 `L = sqrt(k) = sqrt(x*y)`。由于在区间内 `L` 恒定，所以 `sqrt(x1*y1) = sqrt(x0*y0) = L`。
    
6.  将 `L` 的不同表达式代入方程 `L * (√P1 - √P0) = y1 - y0` 中。
    
7.  `sqrt(x1*y1) * sqrt(y1/x1) - sqrt(x0*y0) * sqrt(y0/x0) = y1 - y0`
    
8.  `sqrt(y1^2) - sqrt(y0^2) = y1 - y0`
    
9.  `y1 - y0 = y1 - y0`。证明成立。
    

这个数学上的转换是 V3 实现其复杂功能的核心，它允许合约在不直接操作 `x` 和 `y` 的情况下，精确计算出跨越不同流动性区间的交易结果。

\--------------------------------------------------------------------------------

### Section 6：Uniswap V3 的实现细节：Ticks、Tick Spacing 与费用计算 (XX:XX:XX)

**6.1 Ticks：价格的离散化**

如果允许 LP 在任意价格点设置流动性区间，那么价格轴上将会有无数个边界点，这在计算上是不可行的（会消耗无尽的 Gas）。V3 通过**刻度 (Ticks)** 的概念来解决这个问题。

-   **Tick 定义**: Tick 是对价格空间的离散化划分。LP 只能在这些预设的 Tick 点上添加或移除流动性。
    
-   **Tick 公式**: Tick `i` 对应的价格 `p(i)` 由以下公式定义： `p(i) = 1.0001^i` 这意味着相邻两个 Tick 之间的价格差为 0.01% (1 a basis point)。
    

通过这种方式，连续的价格曲线被转换成了一系列离散的、可管理的价格点。

**6.2 Tick Spacing：控制粒度**

为了进一步优化并适应不同类型的资产，V3 引入了**Tick 间距 (Tick Spacing)**。并非每个 Tick 都可用，LP 只能在 `tickSpacing` 倍数的 Tick 上设置边界。

-   **与手续费挂钩**: V3 提供了几个固定的手续费等级（例如 0.01%, 0.05%, 0.3%, 1%）。每个费率等级对应一个不同的 `tickSpacing`。
    
    -   **稳定币对 (如 USDC/USDT)**: 波动小，适合低费率和最小的 `tickSpacing` (如 1 或 10)，允许非常精细的流动性配置。
        
    -   **主流币对 (如 ETH/USDC)**: 波动适中，使用中等费率和 `tickSpacing` (如 60)。
        
    -   **山寨币/长尾资产**: 波动大，需要高费率来补偿无常损失，同时使用最大的 `tickSpacing` (如 200)，流动性配置粒度较粗。
        

**6.3 数据结构：Tick Bitmap**

在进行交易时，合约需要快速找到下一个有流动性变化的 Tick。遍历所有 Tick 会非常耗费 Gas。为此，V3 使用了一个名为 **Tick Bitmap** 的高效数据结构。

-   **工作原理**: Bitmap 是一个由 0 和 1 组成的序列。每个比特位（bit）对应一个 Tick。如果某个比特位为 `1`，表示对应的 Tick 是一个流动性区间的边界；如果为 `0`，则表示该 Tick 未被使用。
    
-   **优势**: 通过位运算，合约可以极快地在巨大的 Tick 空间中定位到下一个活跃的 Tick，极大地降低了交易的 Gas 成本。
    

**6.4 复杂的费用计算**

在 V3 中，由于流动性是分段的，费用分配也变得异常复杂。当一笔交易发生时，产生的手续费需要根据各自的贡献比例，精确地分配给所有在该交易价格范围内提供了流动性的 LP。

V3 使用了一个精巧的全局和局部累加器系统来解决这个问题：

1.  **全局费用累加器 (**`feeGrowthGlobal`**)**: 池子合约维护一个全局变量，记录自池子创建以来，每单位流动性累计赚取的总手续费。
    
2.  **外部费用累加器 (**`feeGrowthOutside`**)**: 每个被激活的 Tick 会记录两个值，分别代表在它“外部”（即价格更高或更低的一侧）累计的每单位流动性手续费。
    
3.  **计算区间费用**: 当一个 LP 需要计算自己仓位的应计费用时，合约会读取其仓位上下边界 Tick 的 `feeGrowthOutside` 值和全局的 `feeGrowthGlobal` 值。通过一套根据当前价格相对于仓位区间的不同情况而变化的公式，可以精确计算出该特定区间内累计的每单位流动性手续费。
    
4.  **最终分配**: 将区间手续费乘以该 LP 在此区间内提供的流动性数量（`L`），即可得出其应得的总手续费。
    

这个机制虽然理解起来非常复杂和绕口，但它使得 V3 能够在链上以相对高效的方式完成精确到每个 LP 仓位的费用分配。

\--------------------------------------------------------------------------------

### Section 7：Uniswap 生态系统资源与开发者机遇 (XX:XX:XX)

Uniswap 基金会及生态系统为开发者和初创项目提供了丰富的支持资源，旨在鼓励基于其协议的创新。

-   **Uniswap V4 Fellowship**: 这是一个为期数周的线上孵化器项目，旨在教授开发者如何在即将到来的 V4 版本上构建应用（Hooks），项目免费并包含有奖金的黑客松环节。
    
-   **审计补贴 (Audit Subsidies)**: 基金会为基于 Uniswap 生态的项目提供智能合约审计费用补贴，最高可达全额免费，极大地降低了新项目的安全成本。
    
-   **黑客松 (Hackathons)**: Uniswap 是 ETHGlobal 等全球主流黑客松的主要赞助商，并为使用其协议的优秀项目提供丰厚的奖金。`HackMoney` 是一个专注于 DeFi 领域的专项黑客松。
    
-   **UniHack**: 一个持续开放的申请项目，任何在黑客松中构建的、基于 Uniswap 的项目都可以申请额外奖励，最高可达 7500 美元。
    
-   **追溯性资助 (Retroactive Grants)**: 对已经为 Uniswap 生态做出贡献的项目或个人进行奖励。
    
-   **开放式资助计划 (Open Grant Program)**: 开发者可以为自己的创新想法直接向基金会申请资金和技术支持。
    
-   **TL;DR - DeFi Research**: 与哥伦比亚大学等学术机构合办的研究项目，关注最前沿的 DeFi 理论和论文。
    
-   **DeFi Education Fund**: 由 Uniswap 赞助的非营利组织，专注于在美国等地区进行政策宣传和立法者教育，为 DeFi 的合规发展创造有利环境。
    

\--------------------------------------------------------------------------------

## 框架 & 心智模型 (Frameworks & Mental Models)

### 模型一：AMM 作为一种被动式、由套利驱动的价格平衡系统

这个心智模型旨在回答一个根本问题：一个没有中央订单簿的去中心化交易所，是如何发现并维持公允市场价格的？

Uniswap 的价格机制并非主动“设定”价格，而是一个被动且优雅的平衡系统，其运作依赖于外部经济激励。

-   **第一层：数学法则的基石 (**`x * y = k`**)**
    
    -   这是系统的“物理定律”。它本身不包含任何关于“正确”价格的信息，仅定义了两种资产储备量之间必须维持的数学关系。价格（`P = y / x`）是这个定律的直接衍生物，是曲线上某一点的斜率。
        
-   **第二层：外部世界的价格信号（“真理之源”）**
    
    -   视频中将 Binance 等中心化交易所作为价格发现的源头。这个外部市场的价格可以被视为“真实市场价格”。当 AMM 池内价格与此价格发生偏离时，系统的“势能”就产生了。
        
-   **第三层：执行者——逐利的套利者**
    
    -   套利者是连接内部数学世界和外部市场价格的桥梁。他们是系统的“校准器”。当 AMM 价格（例如 ETH=3000）低于外部市场价格（ETH=3200）时，套利者会执行一个负反馈循环：
        
        1.  **买入低价资产**: 在 AMM 中用 USDC 买入“便宜”的 ETH。
            
        2.  **改变内部状态**: 这个行为减少了池中的 ETH 储备（`x` 减少），增加了 USDC 储备（`y` 增加）。
            
        3.  **价格自动校准**: 根据 `P = y / x`，`y` 增加和 `x` 减少共同导致了池内价格 `P` 的上升。
            
        4.  **循环终止**: 套利行为会持续进行，直到池内价格被推高到与外部市场几乎相等（考虑到交易成本），套利空间消失为止。
            
-   **第四层：流动性深度的作用（系统的“惯性”）**
    
    -   `k` 值，即流动性深度，决定了改变价格需要多大的“力”（交易量）。一个 `k` 值很高的深池，就像一个质量很大的物体，需要巨大的交易量才能使其价格发生显著变化，因此表现出更强的价格稳定性。反之，浅池则容易被小额交易剧烈影响。
        

这个框架帮助我们将 AMM 理解为一个依赖外部激励进行自我修正的经济有机体。它不创造价格，而是通过数学规则和开放的参与机制，被动地、但有效地“吸收”和“反映”整个市场的价格。

### 模型二：资本效率的进化——从“惰性资本”到“主动资本”

这个心智模型描绘了 Uniswap 从 V2 到 V3 的核心演化路径，其主线是关于资本效率的哲学转变。

-   **阶段一：V2 的“惰性资本”或“均匀海洋”模型**
    
    -   **核心特征**: 简单、被动、“一劳永逸”。
        
    -   **心智模型**: 想象 V2 的流动性是一个覆盖全球的、深度均匀的海洋。无论你在地球的哪个角落（对应任何价格点），水的深度（流动性）都是一样的。
        
    -   **问题所在**: 这个模型虽然简单，但效率极低。绝大部分海洋区域（极端价格区间）从未有船只（交易）经过，但你的资本却必须覆盖这些无人问津的区域。这是一种典型的“广撒网”策略，大部分资本处于“沉睡”或“惰性”状态。
        
-   **阶段二：V3 的“主动资本”或“精准水坝”模型**
    
    -   **核心特征**: 复杂、主动、需要策略。
        
    -   **心智模型**: V3 不再要求你覆盖整个海洋。相反，它给了你工具，让你可以在最繁忙的航道（最可能发生交易的价格区间）上修建一系列深度极高的“水坝”或“运河”。
        
        -   **集中性**: 你的资本不再是均匀铺开的薄层，而是被集中起来，形成局部极深的流动性。
            
        -   **主动性**: 你必须成为一名“水利工程师”，预测哪些航道会最繁忙，并把你的“水坝”建在那里。如果价格超出了你的“水坝”范围，你的资本将再次变为“惰性”，停止赚取手续费，并面临显著的无常损失风险。
            
    -   **聚合效应**: 对交易者而言，他们看到的不是一个个孤立的“水坝”，而是由所有 LP 的“水坝”聚合起来的一条连续但深度不均的航道。当他们的交易“船只”驶过时，会经历不同深度的水域。
        
-   **演化背后的代价与工具**
    
    -   这个从“惰性”到“主动”的转变，必然要求更复杂的工具集来管理。V3 中那些看似高深的数学（`L` 和 `√P`）和数据结构（Ticks, Bitmap），正是为了实现和管理这种“精准水坝”模型而发明的必要工具。它们解决了如何定义“水坝”的位置（Ticks）、如何高效地在“水坝”之间导航（Bitmap），以及如何计算流经你“水坝”的水流所应带来的收益（费用计算）等问题。
        

这个框架帮助我们理解，Uniswap 的版本迭代并非简单的功能增加，而是一场关于资本部署哲学的深刻革命。它揭示了在去中心化金融中，效率与简单性、主动管理与被动收益之间的核心权衡。
<!-- DAILY_CHECKIN_2026-01-23_END -->

# 2026-01-22
<!-- DAILY_CHECKIN_2026-01-22_START -->


# Plan

-   阅读论文一篇
    
-   完成3项任务
<!-- DAILY_CHECKIN_2026-01-22_END -->

# 2026-01-21
<!-- DAILY_CHECKIN_2026-01-21_START -->



# Plan

-   一篇量化论文
    
-   **CS146S: The Modern Software Developer**
<!-- DAILY_CHECKIN_2026-01-21_END -->

# 2026-01-20
<!-- DAILY_CHECKIN_2026-01-20_START -->




《区块链技术与应用》笔记

# 12\. 比特币的匿名性

-   pseudonymity
    

## 如何提升比特币的匿名性

### 从network layer 入手：

-   多路径转发：洋葱路由TOR
    

> 多路径转发是一种通过多个中继节点转发数据、 使任何单一节点都无法知道通信全貌的网络技术；Tor 的洋葱路由是多路径转发的一种典型实现。

### application layer：

-   coin mixing - 把你的币和其他人的混起来，让人分不清
    

## zero-knowledge proof 零知识证明

> 证明者向验证者证明一个陈述是正确的，而无需透露该陈述是正确的外的任何信息

ex. 私钥产生签名，用公钥验证签名的正确性

-   零知识证明的数学基础
    

# 13\. 比特币引发的思考

-   levelDB结构储存（key, value), 进而存储整个区块链的内容
    
-   分布式共识
    
-   异步 - 通讯系统的延迟是没有上限的
    
-   分布式系统
    
    -   由多台独立计算机组成，这些计算机通过网络通信与协调，对外表现得像一个“整体系统”的系统。
        
-   货币金融学
    
-   比特币中用的哈希算法 - SHA-256
<!-- DAILY_CHECKIN_2026-01-20_END -->

# 2026-01-19
<!-- DAILY_CHECKIN_2026-01-19_START -->






# Plan

-   完成北大肖臻老师的课程
    
-   阅读2篇论文
    
-   完成4项学习任务打卡
    
-   计划rust学习
<!-- DAILY_CHECKIN_2026-01-19_END -->

# 2026-01-17
<!-- DAILY_CHECKIN_2026-01-17_START -->







# Plan

-   阅读2篇加密货币量化相关论文
    
-   完成4个实习计划打卡
<!-- DAILY_CHECKIN_2026-01-17_END -->

# 2026-01-16
<!-- DAILY_CHECKIN_2026-01-16_START -->








# 14\. 以太坊概述

-   区块链2.0
    
-   mining puzzle
    
-   memory hard - ASIC resistance
    
-   proof of work → proof of stake
    
-   支持smart contract
    
-   BitCoin - BTC - decentralized currency - satoshi
    
-   Ethereum - ETH - decentralized contract - wei
    
-   fiat currency
    

# 15\. 以太坊的账户

-   创始人Vitalik
    
-   比特币 - 基于交易模式的账本 - transaction baed ledger
    
-   以太坊 - account-based ledger
    
-   状态树
    
-   replay attack - 记录交易次数nonce
    
-   外部账户 - externally owned account
    
    -   balance
        
    -   nonce ( counter )
        
-   合约账户 - contract account
    
    -   合约账户不能主动发起一个交易
        
    -   code
        
    -   storage
<!-- DAILY_CHECKIN_2026-01-16_END -->

# 2026-01-15
<!-- DAILY_CHECKIN_2026-01-15_START -->









# Plan

-   Bitcoin, Ethereum Whitepaper（配合北大肖臻老师的课程）
    
-   观看前几天的课程回放
    
-   保证至少3小时的学习时间
    

# Notes

### 哈希

-   哈希函数 - cryptographic hash function
    
    -   collision resistance
        
        -   无法找到人为制造collision的方法
            
        -   没有办法篡改内容而不被检测出来
            
    -   hiding
        
        -   哈希函数的计算过程是单向的
            
        -   前提：输入的空间大，分布均匀
            
    -   以上两个性质带来了digital commitment, digital equivalent of a sealed envelope
        
    -   输入空间不够，则在输入后拼接一个随机数
        
    -   puzzle friendly
        
        -   挖矿的过程没有捷径，只能通过尝试不同的nonce才能找到符合要求的解 → proof of work
            
        -   nonce - 随机数
            
        -   H( block header ) ≤ target
            
    -   difficult to solve, but easy to verify
        
-   比特币中的哈希函数 - SHA-256
    
    -   secure hash algorithm
        

### 签名

-   开户：创立一个公钥-私钥对（public key, private key )
    
-   来自asymmetric encryption algorithm
    
    -   加密 - public key - 相当于账号
        
    -   解密 - private key - 相当于账户密码
        
    -   对称加密体系的弱点：密钥分发不便
        
-   encryption key
    
-   签名-私钥，验证签名 - 公钥
    
-   a good source of randomness
    
-   对message取哈希，对哈希签名哈希指针 hash pointers
    

### 区块链

-   区块链与普通链表的区别
    
    -   block chain is a linked list using hash pointers
        

-   实现tamper-evident log
    

### Merkle tree

-   用哈希指针代替了普通指针的binary tree
    
-   只要记住root hash, 就能检测链表中任何部位的修改
    
-   每一个区块都是transaction
    

-   block header - root hash
    
-   block body
    
-   Merkle proof
    
    -   全节点
        
    -   轻节点
        
    -   proof of membership / inclusion
        
        -   O(logN)
            
    -   proof of non-membership
        
        -   O(N)
            
        -   if sorted Merkle tree is applied - O(logN)
<!-- DAILY_CHECKIN_2026-01-15_END -->

# 2026-01-14
<!-- DAILY_CHECKIN_2026-01-14_START -->













近期我正在参与南塘 DAO 的艺术共创营，并有机会直接参与到实际的开发工作中。这一经历让我意识到，相比单纯的概念学习，通过真实项目参与 Web3 的协作与建设，是目前对我来说最有效的成长路径。因此，我将接下来一段时间的学习重点，明确放在“认知夯实 + 实战开发同步推进”上。

在认知层面，我计划系统阅读比特币（Bitcoin）与以太坊（Ethereum）的白皮书，从最原始的设计问题出发，理解去中心化系统试图解决的核心矛盾，以及智能合约与链上计算为何会出现。我希望通过回到源头的方式，建立对 Web3 基础逻辑的整体理解，而不是停留在碎片化的应用层认知。

在实践层面，我将以南塘 DAO 的共创项目为主要载体，参与全栈开发工作，具体包括 Vue 前端 与 TypeScript 后端。我会将 TypeScript 后端作为当前技术能力建设的重点，逐步熟悉接口设计、业务逻辑组织以及与链上数据或合约交互的方式，使自己能够在 Web3 项目中承担真实、可落地的开发任务，而不仅是辅助性工作。

在学习与工作的结合方式上，我会尽量将每一次功能开发、问题排查和技术决策，整理为结构化的学习笔记与复盘记录。通过这种方式，把项目中的实践经验沉淀为可复用的认知资产，也为未来参与更多 Web3 协作项目或开源贡献打下基础。

总体来说，我希望以南塘 DAO 的艺术共创营为起点，通过参与真正“被人使用的“项目驱动的全栈开发实践，一边夯实 Web3 的底层认知，一边提升工程能力，逐步完成从学习者到建设者的转变。这也是我目前最认可、也最适合自己的 Web3 行动路径。
<!-- DAILY_CHECKIN_2026-01-14_END -->

# 2026-01-13
<!-- DAILY_CHECKIN_2026-01-13_START -->














（今天主要看了一位量化交易者的传记，作为加密货币量化投资研究人员，也算是认真学习了一下相关知识😂）

# My life as a quant: reflections on Physics and Finance

> 期权是更常见的衍生品证券（derivative security）的一种特例，衍生品证券的价值衍生于（derived from）作为标的（underlying）证券的价值”

-   做市 - make markets
    
-   布莱克-斯科尔斯方程式”
    

# 一· 因缘际会

“如果你决定没有必要拿A，那么你在大学里就能学到很多东西”——Rabi

> 在1966年及随后的几年中，我怀揣着能够获得李政道那样成功的梦想。按照这个不切实际的标准，只有少数“神童”能够真正实现了他们的诺言。其中一个成为军事分析智囊团成员，在伊拉克入侵科威特之后的海湾战争期间，我在电视里认出了他。还有一个完成了物理学的博士学位课程，之后转入医学院，从事精神学方面的研究，最后成为一名知名的神经网络学专家。第三位在获得哥伦比亚大学物理系最佳本科生荣誉后，患上躁狂抑郁症。但他决定继续搞研究，不间断地在淡黄色笔记本上记录下他每天全神贯注投入工作的分钟数。每次停下来或休息时，他就按停表，将从上一次打断后的工作时间记录下来。每天结束后，他计算出工作时间总数。我自己也有些强迫症，因此很同情他的计算。我知道一个人一天之内能够集中精力、不被打扰的时间可谓少之又少。每想到此，我就立刻开始做自己的工作”

> 我从哥伦比亚大学的老师和学生的命运中得到一个教训：性格和机会与天赋同等重要。运气，再加上我母亲所说的“忍耐”，也就是坚韧不拔的毅力，最后起到至关重要的作用。”

> 像绝大多数物理学者一样，我是个还原论者：我相信可以把复杂的事物简化成它们的构成要素。生物学建立在化学的基础上；而化学只不过是分子和原子的物理运动而已；原子由电子和原子核构成；原子核又包含了质子和中子，而质子和中子似乎都是由夸克组成的。在这个公认的物质分层体系中，究竟什么才是最终的亚核粒子？它们的运动又遵循怎样的规律？这些问题就是粒子物理学研究的范畴。”

> 如果是对的，就能超越牛顿和爱因斯坦：你发现了十诫中的一条。你用神来之笔写下一组定律，它们神奇地描述并预测了“上帝”所创造的世界是如何运行的。这就是我向往的征程，其他任何选择都是我所不愿做出的让步。 ”

# 二· 求学7年

> 如果你不介意浪费最好的青春岁月，那么哥伦比亚大学研究生生活可谓是人间天堂。只要通过了最初的两道坎儿：通过博士资格考试和找到研究指导教授，似乎就没有人会关心在你身上发生了什么。作为一名研究生是一个不错的“闲差”。学校只给你为数不多但能维持生活的奖学金，并希望你不要给他们添麻烦。我在物理系度过了7年清教徒般的生活。我的一个朋友花了10年，最终我们都活着毕业了。”

> 多年后，当我搬到华尔街后，我特别喜欢从事数量金融的那种充实、忙碌的工作方式：总是有程序要写、有交易界面要设计、有计算等着去做。能够有点事忙着，而不是一定要超凡脱俗，这种感觉挺好。”

> 洛伦兹的理论最终沦为历史的注脚，他也从来没有爱因斯坦那种洞察力。弗里德伯格的课程重温了洛伦兹的奋斗史，也让我充分认识到，爱因斯坦理性的、凭借直觉的分析是如何消除或是规避了以前出现的混乱之处。从那时起，我就对理论上的重大突破是如何产生的非常感兴趣。物理学或金融学中的重大发现，绝不会像人们读教科书那样简单，即使这些重大发现出现几年后就会被写入教科书。”

> 我对开创者与门徒间的差距有了更深刻的体会。在传授的时候，所有东西都看上去很简单，但当你独自一人在可感知的、无序世界中挣扎过，你才能知道，制定或是辨别一套最终回过头来看才发现并不那么显而易见的规则有多么难。”

> 物理学家对于四种力非常熟悉：强作用力、电磁力、弱作用力以及引力。强作用力使质子和中子相互结合在一起，共同构成位于每个原子中心的原子核；电磁力使原子中的电子围绕原子核运动，同时发射光波；弱作用力则会产生β衰变，这是一种以释放原子的形式表现出来的原子核放射性衰变；引力是最古老也最为人们所熟知的作用力，是诸如苹果落地，地球与月球运动，行星、恒星和整个银河系星球运动的原因。”
<!-- DAILY_CHECKIN_2026-01-13_END -->

# 2026-01-12
<!-- DAILY_CHECKIN_2026-01-12_START -->















# 《从零到一学习以太坊》

-   EVM - Ethereum Virtual Machine
    

**L1（Layer 1）** 是指：

> 区块链的基础层（Base Layer） 负责：共识、安全、数据最终确认（Finality）

**常见 L1 公链（你一定听过）**

**Ethereum**

**Bitcoin**

**Solana**

**L2（Layer 2）** 是指：

> 构建在 L1 之上的扩展层：把计算和交易“挪出去”，但**把安全性锚定在 L1 上**
<!-- DAILY_CHECKIN_2026-01-12_END -->
<!-- Content_END -->
